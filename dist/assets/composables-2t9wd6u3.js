import{r as e,o as t,a as n,c as r,b as o,n as a}from"./vue-vendor-Cpenns3E.js";import{u as l}from"./stores-D-HQzOOg.js";import{d as s,s as i,q as u,t as c}from"./d3-vendor-TCNr37SR.js";function d(r,o={}){const{initialPosition:a={x:0,y:0},handle:l=null,bounds:s="viewport",onDragStart:i=null,onDrag:u=null,onDragEnd:c=null}=o,d=e({...a}),v=e(!1),p=e({x:0,y:0}),m=e(!1);let h=null;const g=e=>{e.preventDefault();const t=r.value;if(!t)return;const n=t.getBoundingClientRect();p.value={x:e.clientX-n.left,y:e.clientY-n.top},v.value=!0,m.value=!1,document.addEventListener("mousemove",y),document.addEventListener("mouseup",f),document.body.style.cursor="grabbing",i&&i({x:n.left,y:n.top})},y=e=>{if(!v.value)return;m.value=!0;let t=e.clientX-p.value.x,n=e.clientY-p.value.y;if("viewport"===s){const e=r.value;if(e){const r=e.getBoundingClientRect(),o=20;t=Math.max(o,Math.min(t,window.innerWidth-r.width-o)),n=Math.max(o,Math.min(n,window.innerHeight-r.height-o))}}d.value={x:t,y:n},u&&u({x:t,y:n})},f=()=>{v.value&&(v.value=!1,document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",f),document.body.style.cursor="",c&&m.value&&c(d.value))};return t(()=>{const e=r.value;e&&(h=l?"string"==typeof l?e.querySelector(l):l.value||l:e,h&&(h.addEventListener("mousedown",g),h.style.cursor="grab"))}),n(()=>{h&&h.removeEventListener("mousedown",g),v.value&&(document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",f),document.body.style.cursor="")}),{position:d,isDragging:v,hasMoved:m,setPosition:e=>{d.value={...e}}}}function v(){const t=e(new Map),r=e(!1);let o=null,a=null,l=null,s=null;const i=e=>{t.value.delete(e),0===t.value.size&&c()},u=()=>{r.value||(r.value=!0,window.ResizeObserver&&(o=new ResizeObserver(e=>{for(const t of e){const e=t.target,n=m(e);n&&d(n)}})),a=new MutationObserver(e=>{let t=!1;for(const n of e)if("childList"===n.type||"attributes"===n.type&&("class"===n.attributeName||"style"===n.attributeName)){t=!0;break}t&&v()}),l=g(()=>{v()},16),a.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","style","hidden"]}),window.addEventListener("scroll",l,{passive:!0}),document.addEventListener("scroll",l,{passive:!0,capture:!0}))},c=()=>{r.value&&(r.value=!1,o&&(o.disconnect(),o=null),a&&(a.disconnect(),a=null),l&&(window.removeEventListener("scroll",l),document.removeEventListener("scroll",l,{capture:!0}),l=null),s&&(cancelAnimationFrame(s),s=null))},d=e=>{s||(s=requestAnimationFrame(()=>{p(e),s=null}))},v=()=>{s||(s=requestAnimationFrame(()=>{for(const e of t.value.values())p(e);s=null}))},p=e=>{const{element:t,callback:n,options:r,selector:o}=e;if(!document.contains(t))return void i(o);const a=window.getComputedStyle(t);if("none"===a.display||"hidden"===a.visibility)return;const l=t.getBoundingClientRect(),s=r.padding,u={top:l.top-s,left:l.left-s,width:l.width+2*s,height:l.height+2*s};e.lastBounds&&h(u,e.lastBounds)||(e.lastBounds={...u},n(u,t))},m=e=>{for(const n of t.value.values())if(n.element===e)return n;return null},h=(e,t)=>Math.abs(e.top-t.top)<1&&Math.abs(e.left-t.left)<1&&Math.abs(e.width-t.width)<1&&Math.abs(e.height-t.height)<1,g=(e,t)=>{let n,r=0;return function(...o){const a=Date.now();a-r>t?(e.apply(this,o),r=a):(clearTimeout(n),n=setTimeout(()=>{e.apply(this,o),r=Date.now()},t-(a-r)))}};return n(()=>{c()}),{startTracking:(e,n,o={})=>{const a=document.querySelector(e);if(!a)return!1;const l={element:a,selector:e,callback:n,options:{padding:o.padding||8,throttle:o.throttle||16,...o},lastBounds:null};return t.value.set(e,l),r.value||u(),p(l),!0},stopTracking:i,stopAllTracking:()=>{t.value.clear(),c()},isTrackingActive:r,trackedElements:t.value}}function p(t={}){const{showNotifications:n=!0,logToConsole:a=!0,retryAttempts:s=3,retryDelay:i=1e3,persistErrors:u=!0}=t,c=l(),d=e([]),v=e(null),p=e(new Map),m=e(new Map),h=e({total:0,byType:{},byComponent:{},resolved:0,unresolved:0}),g={NETWORK:"network",VALIDATION:"validation",RUNTIME:"runtime",PERMISSION:"permission",DATA:"data",VISUALIZATION:"visualization",STORE:"store",UNKNOWN:"unknown"},y={LOW:"low",MEDIUM:"medium",HIGH:"high",CRITICAL:"critical"},f=r(()=>d.value.length>0),w=r(()=>null!==v.value),E=r(()=>d.value.filter(e=>e.severity===y.CRITICAL)),b=r(()=>d.value.filter(e=>!e.resolved)),T=(e,t={})=>{const{type:n,severity:r}=((e,t={})=>{var n,r;let o=g.UNKNOWN,a=y.MEDIUM;const l=e.message||e.toString(),s=e.stack||"";l.includes("network")||l.includes("fetch")||l.includes("timeout")||l.includes("connection")?(o=g.NETWORK,a=y.HIGH):l.includes("validation")||l.includes("invalid")||l.includes("required")?(o=g.VALIDATION,a=y.LOW):l.includes("permission")||l.includes("unauthorized")||l.includes("forbidden")?(o=g.PERMISSION,a=y.HIGH):l.includes("data")||l.includes("parse")||l.includes("format")?(o=g.DATA,a=y.MEDIUM):s.includes("d3")||s.includes("visualization")||(null==(n=t.component)?void 0:n.includes("Chart"))||(null==(r=t.component)?void 0:r.includes("Map"))?(o=g.VISUALIZATION,a=y.MEDIUM):s.includes("store")||s.includes("pinia")||t.store?(o=g.STORE,a=y.HIGH):(e instanceof TypeError||e instanceof ReferenceError||e instanceof RangeError)&&(o=g.RUNTIME,a=y.HIGH);const i=`${o}_${l.substring(0,50)}`;return(p.value.get(i)||0)>3&&(a=y.CRITICAL),{type:o,severity:a}})(e,t);return{id:Date.now()+Math.random(),message:e.message||e.toString(),stack:e.stack||"",type:n,severity:r,context:t,timestamp:new Date,resolved:!1,retryCount:0,userAgent:"undefined"!=typeof navigator?navigator.userAgent:"",url:"undefined"!=typeof window?window.location.href:"",component:t.component||"unknown",action:t.action||"unknown"}},I=(e,t={})=>{const r=T(e,t),o=`${r.type}_${r.message.substring(0,50)}`;return p.value.set(o,(p.value.get(o)||0)+1),d.value.push(r),A(r),a&&r.stack,n&&R(r),r.severity===y.CRITICAL&&(v.value=r),u&&O(r),d.value.length>100&&(d.value=d.value.slice(-50)),r},A=e=>{h.value.total++,h.value.byType[e.type]||(h.value.byType[e.type]=0),h.value.byType[e.type]++,h.value.byComponent[e.component]||(h.value.byComponent[e.component]=0),h.value.byComponent[e.component]++,h.value.unresolved=b.value.length,h.value.resolved=d.value.length-h.value.unresolved},R=e=>{e.severity},M=e=>{const t=d.value.find(t=>t.id===e);t&&(t.resolved=!0,t.resolvedAt=new Date,v.value&&v.value.id===e&&(v.value=null),A(t))},O=e=>{try{const t=JSON.parse(localStorage.getItem("d2-error-log")||"[]");t.push({...e,stack:e.stack.substring(0,500)});const n=t.slice(-50);localStorage.setItem("d2-error-log",JSON.stringify(n))}catch(t){}};return{errors:d,globalError:v,errorMetrics:h,hasErrors:f,hasGlobalError:w,criticalErrors:E,unresolvedErrors:b,handleError:I,resolveError:M,clearErrors:(e=null)=>{e?d.value=d.value.filter(t=>!e(t)):(d.value=[],v.value=null,p.value.clear(),m.value.clear())},retryOperation:async e=>{const t=d.value.find(t=>t.id===e);if(!(null==t?void 0:t.context.retryFn))return;const n=`${t.type}_${t.message.substring(0,30)}`,r=m.value.get(n)||0;if(!(r>=s))try{m.value.set(n,r+1),t.retryCount++;const o=i*Math.pow(2,r);await new Promise(e=>setTimeout(e,o)),await t.context.retryFn(),M(e)}catch(o){I(o,{...t.context,action:"retry",originalError:t.id})}},wrapAsync:(e,t={})=>async(...n)=>{const{autoRetry:r=!1,maxRetries:o=3,retryDelay:a=1e3}=t;let l=null;for(let i=0;i<=(r?o:0);i++)try{return await e(...n)}catch(s){if(l=s,0!==i&&r||I(s,{...t,retryFn:()=>e(...n),attempt:i+1}),i<o&&r){const e=a*Math.pow(2,i);await new Promise(t=>setTimeout(t,e));continue}break}throw l},withGracefulDegradation:(e,t=null,n={})=>async(...r)=>{try{return await e(...r)}catch(o){return I(o,{...n,degraded:!0,fallbackUsed:!0}),"function"==typeof t?t(o,...r):t}},createCircuitBreaker:(e,t={})=>{const{failureThreshold:n=5,resetTimeout:r=6e4,monitoringPeriod:o=3e4}=t;let a=0,l=null,s="CLOSED",i=Date.now();return async(...t)=>{const u=Date.now();if(l&&u-l>o&&"CLOSED"===s&&(a=0),"OPEN"===s){if(u<i)throw new Error("Circuit breaker is OPEN - operation temporarily unavailable");s="HALF_OPEN"}try{const n=await e(...t);return"HALF_OPEN"===s&&(s="CLOSED",a=0),n}catch(c){throw a++,l=u,a>=n&&(s="OPEN",i=u+r,I(new Error(`Circuit breaker OPEN: ${a} failures detected`),{component:"circuit-breaker",originalError:c.message,action:"circuit_open"})),c}}},createErrorBoundary:(t,n=null)=>{const r=e(null);return o((e,n,o)=>(r.value=I(e,{component:t||(null==n?void 0:n.$options.name)||"Unknown",errorInfo:o,instance:n}),!1)),{boundaryError:r,clearBoundaryError:()=>{r.value=null}}},getRecoverySuggestions:e=>{const t=[];switch(e.type){case g.NETWORK:t.push("Check your internet connection"),t.push("Try refreshing the page"),t.push("Wait a moment and try again");break;case g.DATA:t.push("Verify the data format"),t.push("Check if all required fields are present"),t.push("Try loading different data");break;case g.VISUALIZATION:t.push("Try resizing the window"),t.push("Check if data is properly formatted"),t.push("Try switching to a different visualization");break;case g.PERMISSION:t.push("Check your access permissions"),t.push("Try logging in again"),t.push("Contact your administrator");break;default:t.push("Try refreshing the page"),t.push("Clear your browser cache"),t.push("Contact support if the problem persists")}return t},showErrorDetails:e=>{const t=d.value.find(t=>t.id===e);t&&c.openModal("error-details",{error:t,title:"Error Details",component:"ErrorDetailsModal"})},loadPersistedErrors:()=>{try{return JSON.parse(localStorage.getItem("d2-error-log")||"[]").map(e=>({...e,timestamp:new Date(e.timestamp),resolvedAt:e.resolvedAt?new Date(e.resolvedAt):null}))}catch(e){return[]}},ERROR_TYPES:g,ERROR_SEVERITY:y,initializeErrorHandling:()=>{"undefined"!=typeof window&&(window.addEventListener("error",e=>{I(e.error||new Error(e.message),{component:"global",action:"unhandled_error",filename:e.filename,lineno:e.lineno,colno:e.colno})}),window.addEventListener("unhandledrejection",e=>{I(e.reason||new Error("Unhandled promise rejection"),{component:"global",action:"unhandled_rejection"})}))}}}function m(r,o={}){const{responsive:l=!0,debounceResize:d=250,cleanupSelectors:v=[],autoResize:p=!0}=o,m=e({width:0,height:0}),h=e(!1),g=e(!1);let y=null,f=null;const w=new Map,E=new Map,b=async()=>{r.value&&!g.value&&(await a(),T(),l&&p&&I(),h.value=!0)},T=()=>{if(!r.value)return;const e=r.value.getBoundingClientRect();m.value={width:e.width,height:e.height}},I=()=>{window.ResizeObserver&&r.value&&(y=new ResizeObserver(()=>{f&&clearTimeout(f),f=setTimeout(()=>{T()},d)}),y.observe(r.value))},A=e=>{const t=E.get(e);t&&(t.element.removeEventListener(t.event,t.handler),E.delete(e))},R=()=>{g.value||(g.value=!0,h.value=!1,y&&(y.disconnect(),y=null),f&&(clearTimeout(f),f=null),E.forEach((e,t)=>{A(t)}),E.clear(),w.forEach(e=>{try{e.remove()}catch(t){}}),w.clear(),r.value&&(v.forEach(e=>{try{i(r.value).selectAll(e).remove()}catch(t){}}),i(r.value).selectAll("svg").remove()))};return t(()=>{b()}),n(()=>{R()}),{dimensions:m,isReady:h,isDestroyed:g,initialize:b,updateDimensions:T,cleanup:R,createSelection:(e,t=null)=>{if(!r.value)return null;const n=i(r.value).select(e);return t&&w.set(t,n),n},getSelection:e=>w.get(e),createSVG:(e={})=>{const{width:t=m.value.width,height:n=m.value.height,margin:o={top:20,right:20,bottom:20,left:20},className:a="chart-svg",preserveAspectRatio:l="xMidYMid meet"}=e;if(!r.value)return null;i(r.value).select("svg").remove();const s=i(r.value).append("svg").attr("class",a).attr("width",t).attr("height",n).attr("viewBox",`0 0 ${t} ${n}`).attr("preserveAspectRatio",l),u=s.append("g").attr("class","chart-container").attr("transform",`translate(${o.left}, ${o.top})`);return w.set("svg",s),w.set("container",u),{svg:s,g:u,width:t,height:n,margin:o}},createTransition:(e={})=>{const{duration:t=750,ease:n=u,delay:r=0}=e;return c().duration(t).ease(n).delay(r)},addEventListener:(e,t,n,r=null)=>{if(!e||"function"!=typeof n)return;e.addEventListener(t,n);const o=r||`${t}_${Date.now()}`;return E.set(o,{element:e,event:t,handler:n}),o},removeEventListener:A,d3:s}}export{m as a,d as b,v as c,p as u};
//# sourceMappingURL=composables-2t9wd6u3.js.map

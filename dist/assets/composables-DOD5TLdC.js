import{u as e}from"./stores-D-2ZrdBw.js";import{r as t,c as a,o as n,a as r,b as o,w as s,n as l}from"./vue-vendor-DKeBeTOX.js";import{d as i,s as u,q as c,t as d,a as v,b as p,z as y,c as m,l as h,e as g,f}from"./d3-vendor-D3zeXOrT.js";function w(r={}){const{showNotifications:o=!0,logToConsole:s=!0,retryAttempts:l=3,retryDelay:i=1e3,persistErrors:u=!0}=r,c=e(),d=t([]),v=t(null),p=t(new Map),y=t(new Map),m=t({total:0,byType:{},byComponent:{},resolved:0,unresolved:0}),h={NETWORK:"network",VALIDATION:"validation",RUNTIME:"runtime",PERMISSION:"permission",DATA:"data",VISUALIZATION:"visualization",STORE:"store",UNKNOWN:"unknown"},g={LOW:"low",MEDIUM:"medium",HIGH:"high",CRITICAL:"critical"},f=a(()=>d.value.length>0),w=a(()=>null!==v.value),E=a(()=>d.value.filter(e=>e.severity===g.CRITICAL)),x=a(()=>d.value.filter(e=>!e.resolved)),b=(e,t={})=>{const{type:a,severity:n}=((e,t={})=>{var a,n;let r=h.UNKNOWN,o=g.MEDIUM;const s=e.message||e.toString(),l=e.stack||"";s.includes("network")||s.includes("fetch")||s.includes("timeout")||s.includes("connection")?(r=h.NETWORK,o=g.HIGH):s.includes("validation")||s.includes("invalid")||s.includes("required")?(r=h.VALIDATION,o=g.LOW):s.includes("permission")||s.includes("unauthorized")||s.includes("forbidden")?(r=h.PERMISSION,o=g.HIGH):s.includes("data")||s.includes("parse")||s.includes("format")?(r=h.DATA,o=g.MEDIUM):l.includes("d3")||l.includes("visualization")||(null==(a=t.component)?void 0:a.includes("Chart"))||(null==(n=t.component)?void 0:n.includes("Map"))?(r=h.VISUALIZATION,o=g.MEDIUM):l.includes("store")||l.includes("pinia")||t.store?(r=h.STORE,o=g.HIGH):(e instanceof TypeError||e instanceof ReferenceError||e instanceof RangeError)&&(r=h.RUNTIME,o=g.HIGH);const i=`${r}_${s.substring(0,50)}`;return(p.value.get(i)||0)>3&&(o=g.CRITICAL),{type:r,severity:o}})(e,t);return{id:Date.now()+Math.random(),message:e.message||e.toString(),stack:e.stack||"",type:a,severity:n,context:t,timestamp:new Date,resolved:!1,retryCount:0,userAgent:"undefined"!=typeof navigator?navigator.userAgent:"",url:"undefined"!=typeof window?window.location.href:"",component:t.component||"unknown",action:t.action||"unknown"}},T=(e,t={})=>{const a=b(e,t),n=`${a.type}_${a.message.substring(0,50)}`;return p.value.set(n,(p.value.get(n)||0)+1),d.value.push(a),I(a),s&&a.stack,o&&R(a),a.severity===g.CRITICAL&&(v.value=a),u&&C(a),d.value.length>100&&(d.value=d.value.slice(-50)),a},I=e=>{m.value.total++,m.value.byType[e.type]||(m.value.byType[e.type]=0),m.value.byType[e.type]++,m.value.byComponent[e.component]||(m.value.byComponent[e.component]=0),m.value.byComponent[e.component]++,m.value.unresolved=x.value.length,m.value.resolved=d.value.length-m.value.unresolved},R=e=>{let t="Error",a="error",n=5e3;switch(e.severity){case g.LOW:t="Warning",a="warning",n=3e3;break;case g.MEDIUM:t="Error",a="error",n=5e3;break;case g.HIGH:t="Serious Error",a="error",n=8e3;break;case g.CRITICAL:t="Critical Error",a="error",n=0}c.addNotification({type:a,title:t,message:e.message,duration:n,actions:e.severity!==g.LOW?[{text:"Details",action:()=>S(e.id)},{text:"Retry",action:()=>A(e.id)}]:void 0})},S=e=>{const t=d.value.find(t=>t.id===e);t&&c.openModal("error-details",{error:t,title:"Error Details",component:"ErrorDetailsModal"})},A=async e=>{const t=d.value.find(t=>t.id===e);if(!t||!t.context.retryFn)return;const a=`${t.type}_${t.message.substring(0,30)}`,n=y.value.get(a)||0;if(n>=l)c.addNotification({type:"warning",title:"Retry Limit Reached",message:"Maximum retry attempts exceeded for this operation",duration:5e3});else try{y.value.set(a,n+1),t.retryCount++;const r=i*Math.pow(2,n);await new Promise(e=>setTimeout(e,r)),await t.context.retryFn(),O(e),c.addNotification({type:"success",title:"Operation Successful",message:"The operation was completed successfully after retry",duration:3e3})}catch(r){T(r,{...t.context,action:"retry",originalError:t.id})}},O=e=>{const t=d.value.find(t=>t.id===e);t&&(t.resolved=!0,t.resolvedAt=new Date,v.value&&v.value.id===e&&(v.value=null),I(t))},C=e=>{try{const t=JSON.parse(localStorage.getItem("d2-error-log")||"[]");t.push({...e,stack:e.stack.substring(0,500)});const a=t.slice(-50);localStorage.setItem("d2-error-log",JSON.stringify(a))}catch(t){}};return{errors:d,globalError:v,errorMetrics:m,hasErrors:f,hasGlobalError:w,criticalErrors:E,unresolvedErrors:x,handleError:T,resolveError:O,clearErrors:(e=null)=>{e?d.value=d.value.filter(t=>!e(t)):(d.value=[],v.value=null,p.value.clear(),y.value.clear())},retryOperation:A,wrapAsync:(e,t={})=>async(...a)=>{const{autoRetry:n=!1,maxRetries:r=3,retryDelay:o=1e3}=t;let s=null;for(let i=0;i<=(n?r:0);i++)try{return await e(...a)}catch(l){if(s=l,0!==i&&n||T(l,{...t,retryFn:()=>e(...a),attempt:i+1}),i<r&&n){const e=o*Math.pow(2,i);await new Promise(t=>setTimeout(t,e));continue}break}throw s},withGracefulDegradation:(e,t=null,a={})=>async(...n)=>{try{return await e(...n)}catch(r){return T(r,{...a,degraded:!0,fallbackUsed:!0}),"function"==typeof t?t(r,...n):t}},createCircuitBreaker:(e,t={})=>{const{failureThreshold:a=5,resetTimeout:n=6e4,monitoringPeriod:r=3e4}=t;let o=0,s=null,l="CLOSED",i=Date.now();return async(...t)=>{const u=Date.now();if(s&&u-s>r&&"CLOSED"===l&&(o=0),"OPEN"===l){if(u<i)throw new Error("Circuit breaker is OPEN - operation temporarily unavailable");l="HALF_OPEN"}try{const a=await e(...t);return"HALF_OPEN"===l&&(l="CLOSED",o=0),a}catch(c){throw o++,s=u,o>=a&&(l="OPEN",i=u+n,T(new Error(`Circuit breaker OPEN: ${o} failures detected`),{component:"circuit-breaker",originalError:c.message,action:"circuit_open"})),c}}},createErrorBoundary:(e,a=null)=>{const r=t(null);return n((t,a,n)=>(r.value=T(t,{component:e||(null==a?void 0:a.$options.name)||"Unknown",errorInfo:n,instance:a}),!1)),{boundaryError:r,clearBoundaryError:()=>{r.value=null}}},getRecoverySuggestions:e=>{const t=[];switch(e.type){case h.NETWORK:t.push("Check your internet connection"),t.push("Try refreshing the page"),t.push("Wait a moment and try again");break;case h.DATA:t.push("Verify the data format"),t.push("Check if all required fields are present"),t.push("Try loading different data");break;case h.VISUALIZATION:t.push("Try resizing the window"),t.push("Check if data is properly formatted"),t.push("Try switching to a different visualization");break;case h.PERMISSION:t.push("Check your access permissions"),t.push("Try logging in again"),t.push("Contact your administrator");break;default:t.push("Try refreshing the page"),t.push("Clear your browser cache"),t.push("Contact support if the problem persists")}return t},showErrorDetails:S,loadPersistedErrors:()=>{try{return JSON.parse(localStorage.getItem("d2-error-log")||"[]").map(e=>({...e,timestamp:new Date(e.timestamp),resolvedAt:e.resolvedAt?new Date(e.resolvedAt):null}))}catch(e){return[]}},ERROR_TYPES:h,ERROR_SEVERITY:g,initializeErrorHandling:()=>{"undefined"!=typeof window&&(window.addEventListener("error",e=>{T(e.error||new Error(e.message),{component:"global",action:"unhandled_error",filename:e.filename,lineno:e.lineno,colno:e.colno})}),window.addEventListener("unhandledrejection",e=>{T(e.reason||new Error("Unhandled promise rejection"),{component:"global",action:"unhandled_rejection"})}))}}}function E(e,a={}){const{responsive:n=!0,debounceResize:s=250,cleanupSelectors:v=[],autoResize:p=!0}=a,y=t({width:0,height:0}),m=t(!1),h=t(!1);let g=null,f=null,w=new Map,E=new Map;const x=async()=>{e.value&&!h.value&&(await l(),b(),n&&p&&T(),m.value=!0)},b=()=>{if(!e.value)return;const t=e.value.getBoundingClientRect();y.value={width:t.width,height:t.height}},T=()=>{window.ResizeObserver&&e.value&&(g=new ResizeObserver(()=>{f&&clearTimeout(f),f=setTimeout(()=>{b()},s)}),g.observe(e.value))},I=e=>{const t=E.get(e);t&&(t.element.removeEventListener(t.event,t.handler),E.delete(e))},R=()=>{h.value||(h.value=!0,m.value=!1,g&&(g.disconnect(),g=null),f&&(clearTimeout(f),f=null),E.forEach((e,t)=>{I(t)}),E.clear(),w.forEach(e=>{try{e.remove()}catch(t){}}),w.clear(),e.value&&(v.forEach(t=>{try{u(e.value).selectAll(t).remove()}catch(a){}}),u(e.value).selectAll("svg").remove()))};return r(()=>{x()}),o(()=>{R()}),{dimensions:y,isReady:m,isDestroyed:h,initialize:x,updateDimensions:b,cleanup:R,createSelection:(t,a=null)=>{if(!e.value)return null;const n=u(e.value).select(t);return a&&w.set(a,n),n},getSelection:e=>w.get(e),createSVG:(t={})=>{const{width:a=y.value.width,height:n=y.value.height,margin:r={top:20,right:20,bottom:20,left:20},className:o="chart-svg",preserveAspectRatio:s="xMidYMid meet"}=t;if(!e.value)return null;u(e.value).select("svg").remove();const l=u(e.value).append("svg").attr("class",o).attr("width",a).attr("height",n).attr("viewBox",`0 0 ${a} ${n}`).attr("preserveAspectRatio",s),i=l.append("g").attr("class","chart-container").attr("transform",`translate(${r.left}, ${r.top})`);return w.set("svg",l),w.set("container",i),{svg:l,g:i,width:a,height:n,margin:r}},createTransition:(e={})=>{const{duration:t=750,ease:a=c,delay:n=0}=e;return d().duration(t).ease(a).delay(n)},addEventListener:(e,t,a,n=null)=>{if(!e||"function"!=typeof a)return;e.addEventListener(t,a);const r=n||`${t}_${Date.now()}`;return E.set(r,{element:e,event:t,handler:a}),r},removeEventListener:I,d3:i}}function x(e,a={}){const{margin:n={top:20,right:20,bottom:30,left:40},responsive:r=!0,autoResize:o=!0,updateStrategy:i="merge",transitionDuration:u=750,debounceUpdate:d=100}=a,w=function(e,a={}){const{margin:n={top:20,right:20,bottom:30,left:40},responsive:r=!0,autoResize:o=!0}=a,l=E(e,{responsive:r,autoResize:o}),i=t({scales:{},axes:{},elements:{}}),u=()=>{if(!l.isReady.value)return;const{width:e,height:t}=l.dimensions.value,a=e-n.left-n.right,r=t-n.top-n.bottom,o=l.getSelection("svg");o&&o.attr("width",e).attr("height",t).attr("viewBox",`0 0 ${e} ${t}`),i.value.scales.x&&i.value.scales.x.range([0,a]),i.value.scales.y&&i.value.scales.y.range([r,0]),i.value.axes.x&&i.value.scales.x&&i.value.axes.x.attr("transform",`translate(0, ${r})`).call(v(i.value.scales.x)),i.value.axes.y&&i.value.scales.y&&i.value.axes.y.call(p(i.value.scales.y))};return s(()=>l.dimensions.value,u,{deep:!0}),{...l,chartState:i,setupChart:(e={})=>{const{xScale:t=null,yScale:a=null,colorScale:r=null,xAxis:o=null,yAxis:s=null}=e;if(!l.isReady.value)return;const{width:u,height:c}=l.dimensions.value,d=u-n.left-n.right,v=c-n.top-n.bottom,{svg:p,g:y}=l.createSVG({margin:n,width:u,height:c});if(t&&(i.value.scales.x=t.range([0,d])),a&&(i.value.scales.y=a.range([v,0])),r&&(i.value.scales.color=r),o&&i.value.scales.x){const e=y.append("g").attr("class","x-axis").attr("transform",`translate(0, ${v})`).call(o.scale(i.value.scales.x));i.value.axes.x=e}if(s&&i.value.scales.y){const e=y.append("g").attr("class","y-axis").call(s.scale(i.value.scales.y));i.value.axes.y=e}return{svg:p,g:y,chartWidth:d,chartHeight:v}},updateChart:(e,t)=>{if(!l.isReady.value||"function"!=typeof t)return;const a=l.getSelection("container");a&&t(a,e,i.value)},resizeChart:u,margin:n}}(e,{margin:n,responsive:r,autoResize:o}),x=t(!1),b=t(null),T=t([]);let I=null,R=null;const S=()=>{I&&clearTimeout(I),R&&cancelAnimationFrame(R),I=setTimeout(()=>{R=requestAnimationFrame(A)},d)},A=async()=>{if(0!==T.value.length&&!x.value){x.value=!0;try{const e=[...T.value].sort((e,t)=>e.timestamp-t.timestamp);for(const t of e)await O(t);T.value=[],b.value=Date.now()}catch(e){}finally{x.value=!1}}},O=async e=>{if(w.isReady.value){await l();try{const t=w.getSelection("container");t&&await e.fn(t,e.data,w.chartState.value)}catch(t){}}},C=(e,t={})=>{const{duration:a=u,ease:n=c,delay:r=0,stagger:o=0}=t;return o>0?e.transition().duration(a).ease(n).delay((e,t)=>r+t*o):e.transition().duration(a).ease(n).delay(r)};return{...w,isUpdating:x,lastUpdate:b,queueUpdate:(e,t=null,a=!1)=>{if("function"!=typeof e)return;const n={fn:e,data:t,timestamp:Date.now()};a?O(n):(T.value.push(n),S())},scheduleUpdate:S,executeUpdate:O,createSmoothTransition:C,handleDataJoin:(e,t,a,n={})=>{const{keyFn:r=(e,t)=>t,enterFn:o=null,updateFn:s=null,exitFn:l=null,transitionOptions:i={}}=n,u=e.selectAll(t).data(a,r),c=u.enter();o&&o(c,C(c,i));const d=u;s&&s(d,C(d,i));const v=u.exit();return l?l(v,C(v,i)):C(v,i).style("opacity",0).remove(),{enter:c,update:d,exit:v}},optimizedRender:(e,t,a={})=>{const{chunkSize:n=1e3,batchDelay:r=16}=a;if(!Array.isArray(e)||e.length<=n)return t(e);const o=[];for(let s=0;s<e.length;s+=n)o.push(e.slice(s,s+n));return new Promise(e=>{let a=0;const n=()=>{a>=o.length?e():(t(o[a]),a++,setTimeout(n,r))};n()})},createResponsiveScales:(e,t={})=>{const{xType:a="linear",yType:r="linear",padding:o=.1,nice:s=!0}=t,{width:l,height:i}=w.dimensions.value,u=l-n.left-n.right,c=i-n.top-n.bottom,d={};return e.x&&("linear"===a?(d.x=h().domain(e.x).range([0,u]),s&&d.x.nice()):"time"===a?d.x=g().domain(e.x).range([0,u]):"band"===a&&(d.x=f().domain(e.x).range([0,u]).padding(o))),e.y&&("linear"===r?(d.y=h().domain(e.y).range([c,0]),s&&d.y.nice()):"band"===r&&(d.y=f().domain(e.y).range([c,0]).padding(o))),d},addInteractivity:(e,t={})=>{const{tooltip:a=null,click:n=null,hover:r=null,zoom:o=!1,brush:s=!1}=t;if(a&&e.on("mouseover",(e,t)=>{"function"==typeof a.show&&a.show(e,t)}).on("mousemove",(e,t)=>{"function"==typeof a.move&&a.move(e,t)}).on("mouseout",(e,t)=>{"function"==typeof a.hide&&a.hide(e,t)}),n&&"function"==typeof n&&e.on("click",n),r&&e.on("mouseenter",r.enter||null).on("mouseleave",r.leave||null),o&&"object"==typeof o){const t=y().scaleExtent(o.scaleExtent||[.1,10]).on("zoom",o.onZoom||null);e.call(t)}if(s&&"object"==typeof s){const t=m().on("brush end",s.onBrush||null);e.call(t)}return e},cleanup:()=>{I&&(clearTimeout(I),I=null),R&&(cancelAnimationFrame(R),R=null),T.value=[],w.cleanup()}}}function b(e={}){const{className:a="chart-tooltip",offset:n={x:10,y:-10},fadeIn:r=200,fadeOut:o=100,followMouse:s=!0}=e,l=t(null),i=t(!1),c=t(""),d=t({x:0,y:0}),v=e=>{if(!l.value||!e)return;const t=e.pageX+n.x,a=e.pageY+n.y;d.value={x:t,y:a},l.value.style("left",`${t}px`).style("top",`${a}px`)};return{isVisible:i,content:c,position:d,show:(e,t,n=null)=>{const o=(()=>{if(l.value)return l.value;const e=u("body").append("div").attr("class",a).style("opacity",0).style("position","absolute").style("pointer-events","none").style("z-index",9999);return l.value=e,e})();let d=t;n&&"function"==typeof n&&(d=n(t)),c.value=d,o.html(d).transition().duration(r).style("opacity",1),s&&e&&v(e),i.value=!0},hide:()=>{l.value&&(l.value.transition().duration(o).style("opacity",0),i.value=!1)},updatePosition:v,destroy:()=>{l.value&&(l.value.remove(),l.value=null),i.value=!1},move:v}}export{E as a,x as b,b as c,w as u};
//# sourceMappingURL=composables-DOD5TLdC.js.map

import{d as e}from"./pinia-vendor-CzWhZ9b0.js";import{s as a,n as t,o as l,t as o,l as r,r as n,b as i,e as s,c as u,d}from"./vendor-EN_QrI4H.js";import{r as c,c as v,w as m}from"./vue-vendor-Cpenns3E.js";import{a as h,l as g,b as p,f}from"./d3-vendor-TCNr37SR.js";const w=a().length(3,"Country code must be exactly 3 characters"),y=t().int().min(1960).max(2030),b=t().positive("Value must be positive"),S=t().min(0).max(100);t().min(-180).max(180);const x=t().min(-90).max(90),M=t().min(-180).max(180);l({type:r("Point"),coordinates:o([M,x])});const D=l({type:r("Feature"),properties:n(i()),geometry:l({type:s(["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"]),coordinates:i()})}),I=l({type:r("FeatureCollection"),features:u(D)});l({area_code:w,area:a().min(1,"Area name is required"),item_code:t().int().positive(),item:a().min(1,"Item name is required"),element_code:t().int().positive(),element:a().min(1,"Element name is required"),year:y,unit:a().min(1,"Unit is required"),value:t().nullable(),flag:a().optional()});const P=l({year:y,production:t().nullable().optional(),imports:t().nullable().optional(),exports:t().nullable().optional(),domestic_supply:t().nullable().optional(),feed:t().nullable().optional(),food:t().nullable().optional(),other_uses:t().nullable().optional(),processing:t().nullable().optional(),seed:t().nullable().optional(),stock_variation:t().nullable().optional(),total_supply:t().nullable().optional()}),C=l({country:a().min(1,"Country is required"),item:a().min(1,"Item is required"),unit:a().min(1,"Unit is required"),data:u(P)}),_=u(C);l({country:a().min(1,"Country is required"),country_code:w,item:a().min(1,"Item is required"),year:y,production:b.nullable(),area_harvested:b.nullable(),yield:b.nullable()}),l({region:a().min(1,"Region is required"),item:a().min(1,"Item is required"),year:y,predicted_value:t(),confidence_interval:l({lower:t(),upper:t()}),model_accuracy:S,last_updated:a().datetime()}),l({query:a().min(1,"Search query is required").max(100,"Query too long"),filters:l({countries:u(w).optional(),items:u(a()).optional(),years:l({start:y,end:y}).refine(e=>e.start<=e.end,{message:"Start year must be before or equal to end year"}).optional()}).optional()}),l({format:s(["csv","json","xlsx"],"Invalid export format"),data_type:s(["production","trade","prices","forecast"],"Invalid data type"),filters:l({countries:u(w).min(1,"At least one country must be selected"),years:l({start:y,end:y}).refine(e=>e.start<=e.end,{message:"Start year must be before or equal to end year"}),items:u(a()).min(1,"At least one item must be selected")})}),l({theme:s(["light","dark","auto"]).default("auto"),language:s(["en","es","fr","de"]).default("en"),default_view:s(["dashboard","timeseries","map"]).default("dashboard"),chart_settings:l({animation_duration:t().min(0).max(5e3).default(750),show_tooltips:d().default(!0),show_legend:d().default(!0),color_scheme:s(["default","colorblind","high_contrast"]).default("default")}).default({}),data_settings:l({cache_duration:t().min(300).max(86400).default(3600),auto_refresh:d().default(!1),download_quality:s(["low","medium","high"]).default("medium")}).default({})}),l({success:d(),data:i().optional(),error:l({code:a(),message:a(),details:i().optional()}).optional(),metadata:l({timestamp:a().datetime(),version:a(),total_records:t().int().min(0).optional(),page:t().int().min(1).optional(),limit:t().int().min(1).optional()}).optional()});const k=async(e,a)=>{try{return{success:!0,data:await e.parseAsync(a),errors:null}}catch(t){return{success:!1,data:null,errors:t.errors||[{message:t.message}]}}};const z=new class{constructor(){this.cache=new Map,this.loadingStates=new Map,this.abortControllers=new Map}async loadData(e,a={}){const{onProgress:t=()=>{},chunkSize:l=1048576,parseAsStream:o=!0,cacheKey:r=e,forceReload:n=!1}=a;if(!n&&this.cache.has(r))return this.cache.get(r);if(this.loadingStates.has(r))return this.loadingStates.get(r);const i=new AbortController;this.abortControllers.set(r,i);const s=this._performLoad(e,{onProgress:t,chunkSize:l,parseAsStream:o,signal:i.signal});this.loadingStates.set(r,s);try{const e=await s;return this.cache.set(r,e),e}finally{this.loadingStates.delete(r),this.abortControllers.delete(r)}}async _performLoad(e,a){const{onProgress:t,chunkSize:l,parseAsStream:o,signal:r}=a;try{const a=await fetch(e,{signal:r});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const n=a.headers.get("content-length"),i=n?parseInt(n,10):0;if(i<l||!o){const e=await a.text();return t({loaded:i,total:i,percentage:100}),JSON.parse(e)}return this._streamParseJSON(a.body,i,t,r)}catch(n){if("AbortError"===n.name)throw n;throw n}}async _streamParseJSON(e,a,t,l){const o=e.getReader(),r=new TextDecoder;let n="",i=0;try{for(;;){if(l.aborted)throw new Error("Aborted");const{done:e,value:s}=await o.read();if(e)break;i+=s.length,n+=r.decode(s,{stream:!0});t({loaded:i,total:a,percentage:a?Math.round(i/a*100):0})}return JSON.parse(n)}finally{o.releaseLock()}}async*loadPaginated(e,a={}){const{pageSize:t=1e3,startPage:l=0,pageParam:o="page",sizeParam:r="size",onPageLoad:n=()=>{}}=a;let i=l,s=!0;for(;s;){const a=new URL(e);a.searchParams.set(o,i),a.searchParams.set(r,t);try{const l=await this.loadData(a.toString(),{cacheKey:`${e}_page_${i}`,parseAsStream:!1});n({page:i,data:l}),yield l,s=l.length===t,i++}catch(u){s=!1}}}cancelLoad(e){const a=this.abortControllers.get(e);a&&(a.abort(),this.abortControllers.delete(e),this.loadingStates.delete(e))}clearCache(e=null){e?this.cache.delete(e):this.cache.clear()}getCacheSize(){return this.cache.size}};const E=new class{constructor(){this.cache=new Map,this.baseUrl="",this.validationEnabled=!0}async loadData(e,a=null,t=null,l={}){const o=a||e,{validateResponse:r=this.validationEnabled,throwOnValidationError:n=!1}=l;if(this.cache.has(o))return this.cache.get(o);try{const a=await fetch(e);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const l=await a.json();if(t&&r){const e=await k(t,l);if(e.success)l._validation={valid:!0,errors:null,timestamp:(new Date).toISOString()};else{if(n)throw new Error(`Data validation failed: ${e.errors.map(e=>e.message).join(", ")}`);l._validation={valid:!1,errors:e.errors,timestamp:(new Date).toISOString()}}}return this.cache.set(o,l),l}catch(i){throw i}}async validateCachedData(e,a){if(!this.cache.has(e))throw new Error(`No cached data found for key: ${e}`);const t=this.cache.get(e);return await k(a,t)}setValidationEnabled(e){this.validationEnabled=e}async loadDataIndex(){return this.loadData("/data/index.json","main-index")}async loadFAOIndex(){return this.loadData("/data/fao/index.json","fao-index")}async loadFAOMetadata(){return this.loadData("/data/fao/metadata.json","fao-metadata")}async loadGeoData(e="geo"){const a={world:"/data/geo.json",world_simplified:"/data/geo.json",geo:"/data/geo.json"},t=a[e]||a.geo;return this.loadData(t,`geo-${e}`,I,{throwOnValidationError:!1})}async loadProductionData(e,a){const t=`/data/fao/geo/${`${e}_production_${a}.json`}`;return this.loadData(t,`production-${e}-${a}`)}async loadMLForecast(e){const a=e.replace(".json",""),t=`/data/fao/ml/${a}.json`;return this.loadData(t,`ml-${a}`)}async loadTimeseriesData(e=null){const a="timeseries";if(this.cache.has(a))return this.cache.get(a);try{const t=await z.loadData("/data/fao/timeseries.json",{onProgress:e,cacheKey:a,chunkSize:2097152});if(this.validationEnabled&&_){const e=await k(t,_);e.valid,t._validation=e}return this.cache.set(a,t),t}catch(t){throw t}}async loadProductionRankings(){return this.loadData("/data/fao/production_rankings.json","production-rankings")}async loadTradeBalance(){return this.loadData("/data/fao/trade_balance.json","trade-balance")}async loadNetworkData(){return this.loadData("/data/fao/network.json","network")}async loadSummaryData(){return this.loadData("/data/fao/summary.json","summary")}async loadMLIndex(){return this.loadData("/data/fao/ml/index.json","ml-index")}async loadMLComprehensiveIndex(){return this.loadData("/data/fao/ml/comprehensive_index.json","ml-comprehensive-index")}async loadMLGlobalIndex(){return this.loadData("/data/fao/ml/global_forecasts_index.json","ml-global-index")}async loadMLRegionalIndex(){return this.loadData("/data/fao/ml/regional_forecasts_index.json","ml-regional-index")}async loadMLCountryIndex(){return this.loadData("/data/fao/ml/country_forecasts_index.json","ml-country-index")}async getAvailableProducts(){return(await this.loadDataIndex()).products||[]}async getAvailableYears(){return(await this.loadDataIndex()).years||[]}clearCache(){this.cache.clear()}getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}},L=e("data",()=>{const e=c(null),a=c(new Map),t=c(new Map),l=c(null),o=c(null),r=c(null),n=c(null),i=c(null),s=c(null),u=c(null),d=c(null),h=c(null),g=c(null),p=c(null),f=c("maize_and_products"),w=c("global"),y=c({start:2018,end:2023}),b=c({countries:[],elements:[],items:[]}),S=c([]);c(new Map);const x=c(null),M=c(!1),D=c(new Map),I=c(new Map),P=v(()=>M.value),C=v(()=>null!==e.value),_=v(()=>Object.keys(a.value).length>0||S.value.length>0),k=v(()=>_.value),z=v(()=>S.value.length?S.value.filter(e=>!(e.Year<y.value.start||e.Year>y.value.end)&&(!(b.value.countries.length>0&&!b.value.countries.includes(e.Area))&&(!(b.value.elements.length>0&&!b.value.elements.includes(e.Element))&&!(b.value.items.length>0&&!b.value.items.includes(e.Item))))):[]),L=v(()=>{const e={};return z.value.forEach(a=>{e[a.Item]||(e[a.Item]=[]),e[a.Item].push(a)}),e}),T=v(()=>{const e={};return z.value.forEach(a=>{e[a.Area]||(e[a.Area]=[]),e[a.Area].push(a)}),e}),j=v(()=>{var e,a,t;if(l.value&&Object.keys(l.value).length>0)return Object.keys(l.value).sort();if(null==(a=null==(e=i.value)?void 0:e.data_summary)?void 0:a.food_items)return i.value.data_summary.food_items.sort();const o=(null==(t=n.value)?void 0:t.products)||[],r=[...new Set(S.value.map(e=>e.Item))].sort();return r.length>0?r:o}),A=v(()=>[...new Set(S.value.map(e=>e.Area))].sort()),O=v(()=>{var e;const a=(null==(e=n.value)?void 0:e.years)||[],t=[...new Set(S.value.map(e=>e.Year))].sort();return t.length>0?t:a}),F=v(()=>{if(!z.value.length)return null;const e=z.value.map(e=>parseFloat(e.Value)).filter(e=>!isNaN(e));if(!e.length)return null;const a=e.reduce((e,a)=>e+a,0),t=a/e.length,l=Math.min(...e),o=Math.max(...e);return{count:e.length,sum:a,average:t,min:l,max:o,median:e.sort((e,a)=>e-a)[Math.floor(e.length/2)]}}),V=(e,a)=>{D.value.set(e,a),M.value=Array.from(D.value.values()).some(Boolean)},$=(e,a)=>{I.value.set(e,a)},R=async()=>{const e="data-index";V(e,!0);try{const a=await E.loadDataIndex();return n.value=a,I.value.delete(e),a}catch(a){throw $(e,a.message),a}finally{V(e,!1)}},N=async()=>{const e="fao-metadata";V(e,!0);try{const a=await E.loadFAOMetadata();return i.value=a,I.value.delete(e),a}catch(a){throw $(e,a.message),a}finally{V(e,!1)}},Y=async(a="geo")=>{const t=`geo-${a}`;V(t,!0);try{const l=await E.loadGeoData(a);return e.value=l,I.value.delete(t),l}catch(l){throw $(t,l.message),l}finally{V(t,!1)}},q=async e=>{const a=`forecast-${e}`;V(a,!0);try{const l=await E.loadMLForecast(e);return t.value.set(a,l),I.value.delete(a),l}catch(l){throw $(a,l.message),l}finally{V(a,!1)}},U=q,G=async(e=null)=>{const a="timeseries";V(a,!0);try{const t=await E.loadTimeseriesData(e),o={};return Array.isArray(t)&&t.forEach(e=>{const{item:a,country:t,data:l}=e;o[a]||(o[a]={}),o[a][t]=l}),l.value=o,I.value.delete(a),o}catch(t){throw $(a,t.message),t}finally{V(a,!1)}},H=async()=>{const e="calorie-data";V(e,!0);try{const a=await fetch("/data/processed/calorie_supply.json");if(!a.ok)throw new Error(`Failed to load calorie data: ${a.statusText}`);const t=await a.json();return s.value=t.data,I.value.delete(e),t}catch(a){throw $(e,a.message),a}finally{V(e,!1)}},J=e=>L.value[e]||[];return m([f,w],()=>{k.value}),{geoData:e,productionData:a,forecastData:t,timeseriesData:l,networkData:o,summaryData:r,dataIndex:n,faoMetadata:i,calorieData:s,loading:M,errors:I,mlIndex:u,mlComprehensiveIndex:d,mlGlobalIndex:h,mlRegionalIndex:g,mlCountryIndex:p,selectedProduct:f,selectedRegion:w,selectedYears:y,dataFilters:b,currentData:S,lastUpdated:x,isLoading:P,hasGeoData:C,hasData:_,isDataLoaded:k,filteredData:z,dataByProduct:L,dataByRegion:T,availableProducts:j,availableRegions:A,availableYears:O,dataStats:F,loadDataIndex:R,loadFAOMetadata:N,loadGeoData:Y,loadProductionData:async(e,t)=>{const l=`production-${e}-${t}`;V(l,!0);try{const o=await E.loadProductionData(e,t);return a.value.set(l,o),I.value.delete(l),o}catch(o){throw $(l,o.message),o}finally{V(l,!1)}},loadForecastData:q,loadMLForecast:U,loadTimeseriesData:G,loadNetworkData:async()=>{const e="network";V(e,!0);try{const a=await E.loadNetworkData();return o.value=a,I.value.delete(e),a}catch(a){throw $(e,a.message),a}finally{V(e,!1)}},loadSummaryData:async()=>{const e="summary";V(e,!0);try{const a=await E.loadSummaryData();return r.value=a,I.value.delete(e),a}catch(a){throw $(e,a.message),a}finally{V(e,!1)}},loadCalorieData:H,initializeApp:async()=>{try{await R(),await N(),await Y("geo"),await G(e=>{}),await H()}catch(e){}},getProductionData:(e,t)=>{const l=`production-${e}-${t}`;return a.value.get(l)},getForecastData:e=>{const a=`forecast-${e}`;return t.value.get(a)},clearCache:()=>{a.value.clear(),t.value.clear(),I.value.clear(),D.value.clear(),E.clearCache()},getError:e=>I.value.get(e),isLoadingData:e=>D.value.get(e)||!1,loadMLIndex:async()=>{const e="ml-index";V(e,!0);try{const a=await E.loadMLIndex();return u.value=a,I.value.delete(e),a}catch(a){throw $(e,a.message),a}finally{V(e,!1)}},loadMLComprehensiveIndex:async()=>{const e="ml-comprehensive-index";V(e,!0);try{const a=await E.loadMLComprehensiveIndex();return d.value=a,I.value.delete(e),a}catch(a){throw $(e,a.message),a}finally{V(e,!1)}},loadMLGlobalIndex:async()=>{const e="ml-global-index";V(e,!0);try{const a=await E.loadMLGlobalIndex();return h.value=a,I.value.delete(e),a}catch(a){throw $(e,a.message),a}finally{V(e,!1)}},loadMLRegionalIndex:async()=>{const e="ml-regional-index";V(e,!0);try{const a=await E.loadMLRegionalIndex();return g.value=a,I.value.delete(e),a}catch(a){throw $(e,a.message),a}finally{V(e,!1)}},loadMLCountryIndex:async()=>{const e="ml-country-index";V(e,!0);try{const a=await E.loadMLCountryIndex();return p.value=a,I.value.delete(e),a}catch(a){throw $(e,a.message),a}finally{V(e,!1)}},getAvailableMLForecasts:(e="all")=>{var a,t,l,o;switch(e){case"global":return(null==(a=h.value)?void 0:a.forecasts)||[];case"regional":return(null==(t=g.value)?void 0:t.forecasts)||[];case"country":return(null==(l=p.value)?void 0:l.forecasts)||[];default:return(null==(o=d.value)?void 0:o.forecast_categories)||{}}},setSelectedProduct:e=>{f.value=e},setSelectedRegion:e=>{w.value=e},setSelectedYears:e=>{y.value={...e}},setDataFilters:e=>{b.value={...e}},addCountryFilter:e=>{b.value.countries.includes(e)||b.value.countries.push(e)},removeCountryFilter:e=>{const a=b.value.countries.indexOf(e);a>-1&&b.value.countries.splice(a,1)},clearFilters:()=>{b.value={countries:[],elements:[],items:[]}},transformDataForVisualization:(e="timeseries")=>{if(!z.value.length)return[];switch(e){case"timeseries":return z.value.map(e=>({date:new Date(e.Year,0,1),value:parseFloat(e.Value)||0,year:e.Year,country:e.Area,product:e.Item,element:e.Element}));case"geographic":return z.value.reduce((e,a)=>{const t=a.Area;return e[t]||(e[t]={country:t,total:0,items:[]}),e[t].total+=parseFloat(a.Value)||0,e[t].items.push(a),e},{});case"comparative":return j.value.map(e=>{const a=L.value[e]||[];return{product:e,value:a.reduce((e,a)=>e+(parseFloat(a.Value)||0),0),count:a.length}});default:return z.value}},getDataForProduct:J,getDataForRegion:e=>T.value[e]||[],getTrendData:(e,a=null)=>{let t=J(e);return a&&(t=t.filter(e=>e.Area===a)),t.sort((e,a)=>e.Year-a.Year).map(e=>({year:e.Year,value:parseFloat(e.Value)||0}))},getTimeseriesDataForProduct:(e,a=null)=>{if(!l.value||!l.value[e])return null;const t=l.value[e];if(a){const e={};return Object.entries(t).forEach(([t,l])=>{const o=l.find(e=>e.year===a);o&&(e[t]=o)}),e}return t},getAvailableCountriesForProduct:e=>l.value&&l.value[e]?Object.keys(l.value[e]).sort():[],getAvailableYearsForProduct:e=>{if(!l.value||!l.value[e])return[];const a=new Set;return Object.values(l.value[e]).forEach(e=>{e.forEach(e=>a.add(e.year))}),Array.from(a).sort((e,a)=>e-a)},syncCurrentData:e=>{S.value=e,x.value=new Date}}}),T=e("ui",()=>{const e=c("light"),a=c(!1),t=c("dashboard"),l=c("dashboard"),o=c(""),r=c("Wheat and products"),n=c("production"),i=c(2022),s=c(!1),u=c(1),d=c([0,0]),m=c(!1),h=c([]),g=c(!1),p=c(!1),f=c({}),w=c({}),y=c("overview"),b=c("default"),S=c(!1),x=c(!1),M=c([]),D=c("/"),I=c([]),P=c({dashboard:{visible:!0,minimized:!1,expanded:!0,loading:!1,error:null},timeseries:{visible:!1,minimized:!1,expanded:!0,loading:!1,error:null},simulation:{visible:!1,minimized:!1,expanded:!1,loading:!1,error:null},ml:{visible:!1,minimized:!1,expanded:!1,loading:!1,error:null}}),C=c({language:"de",dateFormat:"DD.MM.YYYY",numberFormat:"de-DE",currency:"EUR",timezone:"Europe/Berlin",animationsEnabled:!0,soundEnabled:!1,highContrast:!1,reducedMotion:!1}),_=c({xs:480,sm:640,md:768,lg:1024,xl:1280,xxl:1536}),k=c({width:"undefined"!=typeof window?window.innerWidth:1024,height:"undefined"!=typeof window?window.innerHeight:768,isMobile:!1,isTablet:!1,isDesktop:!0}),z=v(()=>t.value),E=v(()=>({country:o.value,product:r.value,metric:n.value,year:i.value})),L=v(()=>"dark"===e.value||m.value),T=v(()=>k.value.width<_.value.md),j=v(()=>k.value.width>=_.value.md&&k.value.width<_.value.lg),A=v(()=>k.value.width>=_.value.lg),O=v(()=>Object.keys(P.value)),F=v(()=>Object.entries(P.value).filter(([e,a])=>a.visible).map(([e])=>e)),V=v(()=>Object.entries(P.value).filter(([e,a])=>a.expanded).map(([e])=>e)),$=v(()=>e=>{var a;return(null==(a=P.value[e])?void 0:a.visible)||!1}),R=v(()=>e=>{var a;return(null==(a=P.value[e])?void 0:a.minimized)||!1}),N=v(()=>e=>{var a;return(null==(a=P.value[e])?void 0:a.expanded)||!1}),Y=v(()=>e=>{var a;return(null==(a=P.value[e])?void 0:a.loading)||!1}),q=v(()=>e=>{var a;return(null==(a=P.value[e])?void 0:a.error)||null}),U=v(()=>p.value||h.value.length>0||Object.values(P.value).some(e=>e.loading)),G=v(()=>Object.values(P.value).some(e=>e.error)),H=e=>{void 0!==e.country&&(o.value=e.country),void 0!==e.product&&(r.value=e.product),void 0!==e.metric&&(n.value=e.metric),void 0!==e.year&&(i.value=e.year)},J=()=>{"undefined"!=typeof window&&(k.value={width:window.innerWidth,height:window.innerHeight,isMobile:window.innerWidth<_.value.md,isTablet:window.innerWidth>=_.value.md&&window.innerWidth<_.value.lg,isDesktop:window.innerWidth>=_.value.lg},k.value.isMobile&&a.value&&(a.value=!1))};return"undefined"!=typeof window&&(J(),window.addEventListener("resize",J)),{theme:e,sidebarOpen:a,currentPanel:t,activePanel:l,selectedCountry:o,selectedProduct:r,selectedMetric:n,selectedYear:i,showAnalysisMenu:s,mapZoom:u,mapCenter:d,darkMode:m,loadingMessages:h,isUserInteraction:g,panelStates:P,loading:p,modals:f,tooltips:w,currentView:y,layoutMode:b,compactMode:S,showDebugInfo:x,navigationHistory:M,currentRoute:D,breadcrumbs:I,preferences:C,viewport:k,breakpoints:_,getCurrentPanel:z,getSelectedFilters:E,isDarkMode:L,isMobile:T,isTablet:j,isDesktop:A,availablePanels:O,visiblePanels:F,expandedPanels:V,isPanelVisible:$,isPanelMinimized:R,isPanelExpanded:N,isPanelLoading:Y,getPanelError:q,isLoading:U,hasErrors:G,toggleSidebar:()=>{a.value=!a.value},setSidebarOpen:e=>{a.value=e},setCurrentPanel:e=>{t.value=e,P.value[e]&&(P.value[e].visible=!0,P.value[e].minimized=!1)},setActivePanel:e=>{O.value.includes(e)&&(l.value=e,t.value=e,M.value.push({panel:e,timestamp:new Date,path:D.value}),M.value.length>50&&(M.value=M.value.slice(-50)))},toggleAnalysisMenu:()=>{s.value=!s.value},setSelectedCountry:(e,a=!0)=>{g.value=a,o.value=e,a&&setTimeout(()=>{g.value=!1},100)},setSelectedProduct:(e,a=!0)=>{g.value=a,r.value=e,a&&setTimeout(()=>{g.value=!1},100)},setSelectedMetric:(e,a=!0)=>{g.value=a,n.value=e,a&&setTimeout(()=>{g.value=!1},100)},setSelectedYear:(e,a=!0)=>{g.value=a,i.value=e,a&&setTimeout(()=>{g.value=!1},100)},setMapView:(e,a)=>{u.value=e,d.value=a},toggleDarkMode:()=>{m.value=!m.value,m.value?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},toggleTheme:()=>{e.value="light"===e.value?"dark":"light",m.value="dark"===e.value,"undefined"!=typeof document&&document.documentElement.classList.toggle("dark",L.value)},setTheme:a=>{e.value=a,m.value="dark"===a,"undefined"!=typeof document&&document.documentElement.classList.toggle("dark",L.value)},showPanel:e=>{P.value[e]&&(P.value[e].visible=!0,P.value[e].minimized=!1,t.value=e)},hidePanel:e=>{P.value[e]&&(P.value[e].visible=!1)},togglePanel:e=>{P.value[e]&&(P.value[e].visible=!P.value[e].visible)},minimizePanel:e=>{P.value[e]&&(P.value[e].minimized=!0)},maximizePanel:e=>{P.value[e]&&(P.value[e].minimized=!1)},expandPanel:e=>{P.value[e]&&(P.value[e].expanded=!0)},collapsePanel:e=>{P.value[e]&&(P.value[e].expanded=!1)},setPanelLoading:(e,a)=>{P.value[e]&&(P.value[e].loading=a)},setPanelError:(e,a)=>{P.value[e]&&(P.value[e].error=a)},clearPanelError:e=>{P.value[e]&&(P.value[e].error=null)},addLoadingMessage:e=>{const a=Date.now()+Math.random();return h.value.push({id:a,message:e}),a},removeLoadingMessage:e=>{const a=h.value.findIndex(a=>a.id===e);a>-1&&h.value.splice(a,1)},clearLoadingMessages:()=>{h.value=[]},updateFilters:H,resetUI:()=>{t.value="dashboard",o.value="",r.value="Wheat and products",n.value="production",i.value=2022,s.value=!1,u.value=1,d.value=[0,0],h.value=[],Object.keys(P.value).forEach(e=>{P.value[e]={visible:"dashboard"===e,minimized:!1}})},initializeUI:()=>{"true"===localStorage.getItem("darkMode")&&(m.value=!0,document.documentElement.classList.add("dark"));const e=localStorage.getItem("uiFilters");if(e)try{const a=JSON.parse(e);H(a)}catch(a){}},savePreferences:()=>{localStorage.setItem("darkMode",m.value.toString()),localStorage.setItem("theme",e.value),localStorage.setItem("uiFilters",JSON.stringify(E.value)),localStorage.setItem("uiPreferences",JSON.stringify(C.value))},openModal:(e,a={})=>{f.value[e]={open:!0,config:a,timestamp:new Date}},closeModal:e=>{f.value[e]&&(f.value[e].open=!1)},isModalOpen:e=>{var a;return(null==(a=f.value[e])?void 0:a.open)||!1},showTooltip:(e,a)=>{w.value[e]={visible:!0,config:a,timestamp:new Date}},hideTooltip:e=>{w.value[e]&&(w.value[e].visible=!1)},setCurrentView:e=>{y.value=e},setLayoutMode:e=>{b.value=e},setCompactMode:e=>{S.value=e},updateViewport:J,setPreference:(e,a)=>{C.value.hasOwnProperty(e)&&(C.value[e]=a)},updateBreadcrumbs:e=>{I.value=e},setGlobalLoading:e=>{p.value=e}}}),j=Object.freeze(Object.defineProperty({__proto__:null,useUIStore:T},Symbol.toStringTag,{value:"Module"})),A=e("tour",()=>{const e=c(!1),a=c(null),t=c(0),l=c(0),o=c(!1),r=c(!1),n=c([]),i=c(null),s=c(null),u=c([]),d=c(!1),h=c(!1),g=c(null),p=c({top:0,left:0}),f=c(null),w=c({width:400,height:"auto"}),y=c({minWidth:300,maxWidth:600,minHeight:200,maxHeight:500}),b=c(!1),S=c(null),x=c("true"===localStorage.getItem("tour-seen-intro")),M=c(JSON.parse(localStorage.getItem("tour-completed")||"[]")),D=c("true"===localStorage.getItem("tour-skip-animations")),I=c(JSON.parse(localStorage.getItem("tour-preferences")||"{}")),P=v(()=>l.value?(t.value+1)/l.value*100:0),C=v(()=>t.value>0&&!r.value),_=v(()=>t.value<l.value-1&&!r.value),k=v(()=>t.value===l.value-1),z=v(()=>0===t.value),E=v(()=>a.value&&M.value.includes(a.value)),L=(n="user_action")=>{const c=P.value;A("tour_stopped",{tourId:a.value,completionRate:c,reason:n,stepIndex:t.value}),"completed"===n&&a.value&&j(a.value),e.value=!1,d.value=!1,h.value=!1,a.value=null,i.value=null,s.value=null,t.value=0,l.value=0,g.value=null,f.value=null,u.value=[],o.value=!1,r.value=!1,w.value={width:400,height:"auto"},b.value=!1,S.value=null},T=e=>!(e<0||e>=l.value)&&(u.value.push(t.value),t.value=e,s.value=i.value.steps[e],A("tour_step_changed",{tourId:a.value,fromStep:u.value[u.value.length-1],toStep:e}),!0),j=e=>{M.value.includes(e)||(M.value.push(e),localStorage.setItem("tour-completed",JSON.stringify(M.value)))},A=(e,a={})=>{window.gtag&&window.gtag("event",e,{custom_parameter_1:a.tourId,custom_parameter_2:a.stepIndex})};return m(s,(e,a)=>{var t;e&&e!==a&&(null==(t=e.actions)?void 0:t.onEnter)&&e.actions.onEnter()}),m(P,a=>{100===a&&e.value&&setTimeout(()=>{e.value&&L("completed")},2e3)}),{isActive:e,currentTourId:a,currentStepIndex:t,totalSteps:l,isPaused:o,isLoading:r,availableTours:n,currentTour:i,currentStep:s,stepHistory:u,overlayVisible:d,tooltipVisible:h,highlightedElement:g,tooltipPosition:p,spotlightBounds:f,hasSeenIntro:x,completedTours:M,skipAnimations:D,userPreferences:I,tooltipDimensions:w,tooltipConstraints:y,floatingMode:b,positioningMetadata:S,progress:P,canGoPrevious:C,canGoNext:_,isLastStep:k,isFirstStep:z,hasCompletedCurrentTour:E,startTour:(r,c={})=>{const v=n.value.find(e=>e.id===r);return!!v&&(a.value=r,i.value=v,l.value=v.steps.length,t.value=c.startStep||0,s.value=v.steps[t.value],e.value=!0,d.value=!0,h.value=!0,o.value=!1,u.value=[],A("tour_started",{tourId:r,totalSteps:l.value}),!0)},stopTour:L,pauseTour:()=>{o.value=!0,d.value=!1,h.value=!1,A("tour_paused",{tourId:a.value,stepIndex:t.value})},resumeTour:()=>{o.value=!1,d.value=!0,h.value=!0,A("tour_resumed",{tourId:a.value,stepIndex:t.value})},goToStep:T,nextStep:()=>_.value?T(t.value+1):!!k.value&&(L("completed"),!0),previousStep:()=>!!C.value&&T(t.value-1),registerTour:e=>{const a=n.value.findIndex(a=>a.id===e.id);a>=0?n.value[a]=e:n.value.push(e)},setHighlightedElement:(e,a=null)=>{g.value=e,f.value=a},setTooltipPosition:e=>{p.value=e},setTooltipDimensions:e=>{w.value=e},setTooltipConstraints:e=>{y.value={...y.value,...e}},setFloatingMode:e=>{b.value=e},setPositioningMetadata:e=>{S.value=e},markTourCompleted:j,markIntroSeen:()=>{x.value=!0,localStorage.setItem("tour-seen-intro","true")},setUserPreference:(e,a)=>{I.value[e]=a,localStorage.setItem("tour-preferences",JSON.stringify(I.value))},setSkipAnimations:e=>{D.value=e,localStorage.setItem("tour-skip-animations",e.toString())},resetTourData:()=>{localStorage.removeItem("tour-completed"),localStorage.removeItem("tour-seen-intro"),localStorage.removeItem("tour-preferences"),localStorage.removeItem("tour-skip-animations"),x.value=!1,M.value=[],D.value=!1,I.value={}},trackEvent:A}}),O=Object.freeze(Object.defineProperty({__proto__:null,useTourStore:A},Symbol.toStringTag,{value:"Module"})),F=e("visualization",()=>{const e=c(null),a=c(new Map),t=c(new Set),l=c(new Map),o=c([]),r=c(new Map),n=c(new Map),i=c(new Map),s=c(new Map),u=c({worldMap:{width:800,height:500,projection:"geoNaturalEarth1",colorScheme:"viridis",showLegend:!0,showTooltips:!0},timeseries:{width:600,height:400,margin:{top:20,right:30,bottom:40,left:40},lineColor:"#3b82f6",showPoints:!0,showGrid:!0},barChart:{width:500,height:300,margin:{top:20,right:30,bottom:40,left:60},colorScheme:"category10",orientation:"vertical"},scatterPlot:{width:500,height:400,margin:{top:20,right:30,bottom:40,left:40},pointSize:4,pointOpacity:.7},networkGraph:{width:700,height:500,linkDistance:100,nodeRadius:8,charge:-300,showLabels:!0},ml:{width:800,height:500,margin:{top:20,right:120,bottom:40,left:60},historicalColor:"#3b82f6",predictionColor:"#ef4444",confidenceColor:"#f59e0b"},simulation:{width:800,height:500,margin:{top:20,right:30,bottom:40,left:60},baselineColor:"#6b7280",scenarioColor:"#ef4444"}}),d=c({duration:750,ease:"d3.easeQuadInOut",enabled:!0}),m=c({production:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],forecast:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],trade:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],regions:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],analysis:["#3b82f6","#ef4444","#f59e0b","#10b981","#8b5cf6","#f97316","#06b6d4","#84cc16"],simulation:["#6b7280","#ef4444","#f59e0b","#10b981"],ml:["#3b82f6","#ef4444","#f59e0b"]}),w=c(new Map),y=c([]),b=c(!1),S=v(()=>e=>u.value[e]||{}),x=v(()=>e=>m.value[e]||m.value.production),M=v(()=>d.value.enabled),D=v(()=>e=>l.value.get(e)||{initialized:!1,data:null,error:null,lastUpdate:null}),I=v(()=>e=>r.value.get(e)||[]),P=v(()=>e=>n.value.get(e)||{}),C=v(()=>e=>i.value.get(e)||null),_=v(()=>e=>s.value.get(e)||{k:1,x:0,y:0}),k=v(()=>e=>t.value.has(e)),z=v(()=>e=>{const a=n.value.get(e)||{};return Object.keys(a).length>0}),E=v(()=>o.value.slice(-100)),L=e=>a.value.get(e),T=e=>{const t=a.value.get(e);t&&"function"==typeof t.destroy&&t.destroy(),a.value.delete(e)},j=(e,a)=>{u.value[e]&&(u.value[e]={...u.value[e],...a})},A=(e,a,t)=>{j(e,{width:a,height:t})},O=(e,a=1.6)=>{if(!e)return{width:800,height:500};const t=e.clientWidth,l=Math.max(300,t-40);return{width:l,height:Math.max(200,l/a)}},F=e=>{const a=document.createElement("canvas"),t=a.getContext("2d"),l=(new XMLSerializer).serializeToString(e),o=new Image;return new Promise((e,r)=>{o.onload=()=>{a.width=o.width,a.height=o.height,t.drawImage(o,0,0),e(a.toDataURL("image/png"))},o.onerror=r,o.src=`data:image/svg+xml;base64,${btoa(l)}`})},V=e=>{const a=(new XMLSerializer).serializeToString(e);return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(a)}`},$=e=>F(e),R=()=>{a.value.forEach((e,a)=>{T(a)}),e.value=null},N=(e,a)=>{l.value.set(e,{...D.value(e),...a,lastUpdate:new Date})},Y=(e,a)=>{r.value.set(e,a),q(e,"selection",{elements:a})},q=(e,a,t={})=>{o.value.push({id:Date.now()+Math.random(),vizId:e,type:a,data:t,timestamp:new Date}),o.value.length>100&&(o.value=o.value.slice(-100))},U=async()=>{if(!b.value&&0!==y.value.length){for(b.value=!0,y.value.sort((e,a)=>{const t={high:0,normal:1,low:2};return t[e.priority]-t[a.priority]});y.value.length>0;){const a=y.value.shift();try{await a.updateFn()}catch(e){N(a.vizId,{error:e.message})}}b.value=!1}};return{mapInstance:e,chartInstances:a,visualizationConfigs:u,animationSettings:d,colorSchemes:m,activeVisualizations:t,visualizationStates:l,selectedElements:r,filters:n,brushSelections:i,zoomStates:s,interactionHistory:o,transformationCache:w,updateQueue:y,isUpdating:b,getVisualizationConfig:S,getColorScheme:x,isAnimationEnabled:M,getVisualizationState:D,getSelectedElements:I,getFilters:P,getBrushSelection:C,getZoomState:_,isVisualizationActive:k,hasActiveFilters:z,getInteractionHistory:E,setMapInstance:a=>{e.value=a},getMapInstance:()=>e.value,setChartInstance:(e,t)=>{a.value.set(e,t)},getChartInstance:L,removeChartInstance:T,updateVisualizationConfig:j,setAnimationSettings:e=>{d.value={...d.value,...e}},toggleAnimation:()=>{d.value.enabled=!d.value.enabled},updateMapConfig:e=>{j("worldMap",e)},setMapProjection:e=>{j("worldMap",{projection:e})},setMapColorScheme:e=>{j("worldMap",{colorScheme:e})},setMapDimensions:(e,a)=>{j("worldMap",{width:e,height:a})},updateChartConfig:(e,a)=>{j(e,a)},setChartDimensions:A,setChartMargin:(e,a)=>{j(e,{margin:a})},getResponsiveDimensions:O,updateResponsiveConfig:(e,a,t)=>{const{width:l,height:o}=O(a,t);return A(e,l,o),{width:l,height:o}},createColorScale:(e,a="production")=>{const t=x.value(a);return h().domain(e).range(t)},createLinearScale:(e,a)=>g().domain(e).range(a),createTimeScale:(e,a)=>p().domain(e).range(a),formatValue:(e,a="number")=>{if(null==e)return"N/A";switch(a){case"number":return f(",.0f")(e);case"percentage":return f(".1%")(e);case"currency":return f("$,.0f")(e);case"compact":return f(".2s")(e);default:return e.toString()}},exportVisualization:(e,a="png")=>{const t=L(e);if(!t)return null;const l=t.node?t.node():t;if(!l)return null;switch(a){case"png":return F(l);case"svg":return V(l);case"pdf":return $(l);default:return null}},exportToPNG:F,exportToSVG:V,cleanup:R,resetToDefaults:()=>{R(),t.value.clear(),l.value.clear(),r.value.clear(),n.value.clear(),i.value.clear(),s.value.clear(),o.value=[],w.value.clear(),y.value=[],u.value={worldMap:{width:800,height:500,projection:"geoNaturalEarth1",colorScheme:"viridis",showLegend:!0,showTooltips:!0},timeseries:{width:600,height:400,margin:{top:20,right:30,bottom:40,left:40},lineColor:"#3b82f6",showPoints:!0,showGrid:!0},barChart:{width:500,height:300,margin:{top:20,right:30,bottom:40,left:60},colorScheme:"category10",orientation:"vertical"},scatterPlot:{width:500,height:400,margin:{top:20,right:30,bottom:40,left:40},pointSize:4,pointOpacity:.7},networkGraph:{width:700,height:500,linkDistance:100,nodeRadius:8,charge:-300,showLabels:!0},ml:{width:800,height:500,margin:{top:20,right:120,bottom:40,left:60},historicalColor:"#3b82f6",predictionColor:"#ef4444",confidenceColor:"#f59e0b"},simulation:{width:800,height:500,margin:{top:20,right:30,bottom:40,left:60},baselineColor:"#6b7280",scenarioColor:"#ef4444"}},d.value={duration:750,ease:"d3.easeQuadInOut",enabled:!0}},setVisualizationState:N,activateVisualization:e=>{t.value.add(e)},deactivateVisualization:e=>{t.value.delete(e)},setSelectedElements:Y,addSelectedElement:(e,a)=>{const t=I.value(e);Y(e,[...t,a])},removeSelectedElement:(e,a)=>{const t=I.value(e);Y(e,t.filter(e=>e!==a))},clearSelection:e=>{r.value.set(e,[]),q(e,"clear_selection")},setFilter:(e,a,t)=>{const l=P.value(e);n.value.set(e,{...l,[a]:t}),q(e,"filter",{key:a,value:t})},removeFilter:(e,a)=>{const t=P.value(e),{[a]:l,...o}=t;n.value.set(e,o),q(e,"remove_filter",{key:a})},clearFilters:e=>{n.value.set(e,{}),q(e,"clear_filters")},setBrushSelection:(e,a)=>{i.value.set(e,a),q(e,"brush",{selection:a})},setZoomState:(e,a)=>{s.value.set(e,a),q(e,"zoom",{state:a})},recordInteraction:q,queueUpdate:(e,a,t="normal")=>{y.value.push({vizId:e,updateFn:a,priority:t,timestamp:Date.now()}),U()},processUpdateQueue:U,cacheTransformation:(e,a)=>{if(w.value.set(e,{data:a,timestamp:Date.now()}),w.value.size>100){const e=Array.from(w.value.entries());e.sort((e,a)=>e[1].timestamp-a[1].timestamp);e.slice(0,20).forEach(([e])=>w.value.delete(e))}},getCachedTransformation:e=>{const a=w.value.get(e);return a&&Date.now()-a.timestamp<3e5?a.data:null},clearCache:()=>{w.value.clear()}}});export{L as a,F as b,A as c,j as d,O as e,T as u};
//# sourceMappingURL=stores-D-HQzOOg.js.map

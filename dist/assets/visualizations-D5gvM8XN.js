import{a as e,u as t,b as a}from"./stores-D-HQzOOg.js";import{L as r,B as l}from"./ui-components-8C-aqfMN.js";import{s as n,n as i,i as o,z as s,l as c,c as d,m as u,e as p,g as y,b as h,h as m,j as f,k as g,o as v,p as x,r as b,u as k,v as w,f as C,d as A,w as M}from"./d3-vendor-TCNr37SR.js";import{c as S,b as _,_ as R}from"./panels-BiDjiUhN.js";import{d as z,r as D,P as L,c as B,w as E,o as N,n as P,a as T,e as I,l as U,q as K,g as F,f as O,i as $,t as G,j,p as V,k as H,s as Y}from"./vue-vendor-Cpenns3E.js";import{a as W}from"./composables-2t9wd6u3.js";const Z={ref:"containerRef",class:"chart-container relative w-full h-full bg-white dark:bg-gray-800 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",style:{"min-height":"600px",width:"100%",height:"100%"}},q={key:1,class:"absolute inset-0 bg-error-50 dark:bg-error-900/20 flex items-center justify-center z-10"},J={class:"text-center"},X={class:"text-error-600 dark:text-error-400 mb-3"},Q={class:"absolute top-4 right-4 z-20 flex flex-col space-y-2"},ee={ref:"svgContainerRef",class:"map-svg-container",style:{width:"100%",height:"100%","min-height":"600px",position:"relative"}},te={key:0,class:"absolute inset-0 flex items-center justify-center text-gray-500"};const ae=R(z({__name:"WorldMap",props:{width:{default:800},height:{default:600},selectedProduct:{default:"Wheat and products"},selectedYear:{default:2022},selectedMetric:{default:"production"}},emits:["countryClick","countryHover"],setup(h,{expose:m,emit:f}){const g=h,v=f,x=e(),b=t(),k=a(),w=D(),C=D(),A=D(!1),M=D(null),R=L(null),z=L([]),I=D(!1);let U=0;const K=D(null),F=D([0,1e8]),O=D("1000 t");let $=null;const G={element:null,init:()=>{$||($=n("body").append("div").attr("class","worldmap-tooltip").style("position","absolute").style("padding","10px").style("background","rgba(0, 0, 0, 0.9)").style("color","white").style("border-radius","4px").style("pointer-events","none").style("font-size","14px").style("box-shadow","0 2px 4px rgba(0,0,0,0.2)").style("z-index","9999").style("opacity",0).style("transition","opacity 0.2s")),G.element=$},show:(e,t,a)=>{$||G.init();const r=a?a():"No data",l=e.pageX||e.clientX,n=e.pageY||e.clientY;$.html(r).style("opacity",1).style("left",l+10+"px").style("top",n-28+"px")},hide:()=>{$&&$.style("opacity",0)},destroy:()=>{$&&($.remove(),$=null)}},j=()=>Array.isArray(z.value)?z.value.filter(e=>e.value>0):[];let V,H,Y,W;const Z=["#440154","#471365","#481F70","#482878","#46337E","#423E85","#3E4A89","#39558C","#32608D","#2D6B8E","#29768E","#25818E","#228C8D","#20978C","#20A386","#2AB07E","#41BD72","#5DC863","#7DD151","#FDE725"],q=B(()=>({projection:"naturalEarth1",colorScheme:Z,...k.getVisualizationConfig("worldMap")})),J=async()=>{if(w.value&&C.value&&!I.value){I.value=!0;try{A.value=!0,M.value=null;const e=await x.loadGeoData("geo");R.value=e,G.init(),await X(e)}catch(e){M.value="Fehler beim Laden der Karte"}finally{requestAnimationFrame(()=>{A.value=!1})}}},X=async e=>{var t;if(!C.value)return;if(!(null==e?void 0:e.features)||!Array.isArray(e.features))return;const a=C.value,r=n(a),l=r.select("svg");l.empty()||l.remove();const c=C.value.getBoundingClientRect();let d=c.width,u=c.height;if(d<10||u<10){const e=null==(t=w.value)?void 0:t.getBoundingClientRect();if(e&&e.width>10&&e.height>10)d=e.width,u=e.height;else if(C.value.parentElement){const e=C.value.parentElement.getBoundingClientRect();d=e.width||g.width,u=e.height||g.height}}d<100&&(d=g.width),u<100&&(u=g.height),0!==d&&0!==u||(d=g.width,u=g.height);const p=r.append("svg").attr("class","world-map-svg").attr("width",d).attr("height",u).attr("viewBox",`0 0 ${d} ${u}`).attr("preserveAspectRatio","xMidYMid meet").style("width","100%").style("height","100%").style("display","block").style("background-color","transparent");V=i().scale(d/5.5).translate([d/2,u/2.2]),H=o().projection(V),W=s().scaleExtent([.8,8]).on("zoom",e=>{p.select(".map-container").attr("transform",e.transform)}),p.call(W);const y=p.append("g").attr("class","map-container");Q(y,e.features);const h=g.selectedProduct,m=g.selectedYear;if(h&&m){b.setSelectedProduct(h),await P();try{let e=0;for(;!x.timeseriesData&&e<10;)await new Promise(e=>setTimeout(e,200)),e++;if(x.timeseriesData&&x.timeseriesData[h]);else if(x.timeseriesData)try{await x.loadProductionData(h,m)}catch(f){}await P(),await te();const t=n(C.value).select(".map-container");t.empty()||le(t)}catch(f){}}j().length>0&&le(y)},Q=(e,t)=>{const a=document.documentElement.classList.contains("dark"),r=a?"#374151":"#e5e7eb",l=a?"#4B5563":"#ffffff",n=e.selectAll(".country").data(t,e=>e.properties.iso_a3||e.properties.adm0_a3||e.properties.name);n.exit().remove();const i=n.enter().append("path").attr("class","country").attr("d",H).attr("fill",r).attr("stroke",l).attr("stroke-width",.5).style("cursor","pointer").on("click",oe).on("mouseover",se).on("mouseout",ce);n.merge(i).attr("d",H).attr("fill",r).attr("stroke",l),e.selectAll(".country").size()},ee=e=>{if(e.select(".legend-group").remove(),!K.value||!F.value)return;const t=200,a=20,r=30,l=e.node(),n=l?l.clientWidth:g.width,i=l?l.clientHeight:g.height,o=e.append("g").attr("class","legend-group").attr("transform",`translate(${n-t-a}, ${i-10-r})`),s="legend-gradient";let u=e.select("defs");u.empty()&&(u=e.append("defs"));const p=u.append("linearGradient").attr("id",s).attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%"),y=document.documentElement.classList.contains("dark"),h=y?"#4B5563":"#e5e7eb";o.append("rect").attr("width",t).attr("height",10).attr("fill",`url(#${s})`).attr("stroke",h).attr("stroke-width",.5);const m=c().domain(F.value).range([0,t]);p.selectAll("stop").remove(),Z.forEach((e,t)=>{const a=t/Z.length*100,r=(t+1)/Z.length*100;p.append("stop").attr("offset",`${a}%`).attr("stop-color",e),t<Z.length-1&&p.append("stop").attr("offset",`${r}%`).attr("stop-color",e)});const f=[],v=(F.value[1]-F.value[0])/(Z.length-1);f.push(F.value[0]);for(const c of[5,10,15])f.push(F.value[0]+v*c);f.push(F.value[1]);const x=d(m).ticks(f?f.length:5).tickFormat(S(O.value));f&&x.tickValues(f);const b=y?"#D1D5DB":"#374151",k=o.append("g").attr("transform","translate(0, 10)").call(x);k.selectAll("text").style("font-size","10px").style("fill",b),k.selectAll("path").style("stroke",b),k.selectAll("line").style("stroke",b),o.append("text").attr("x",100).attr("y",-5).attr("text-anchor","middle").style("font-size","11px").style("font-weight","500").style("fill",b).text(()=>{const e={production:"Produktion",import_quantity:"Import",export_quantity:"Export",domestic_supply:"Versorgung"}[g.selectedMetric]||"Wert";let t="";return t="1000 t"===O.value?"(1000 t)":"t"===O.value?"(t)":"kg"===O.value?"(kg)":`(${O.value})`,`${e} ${t}`})},te=async()=>{if(g.selectedProduct&&g.selectedYear)try{let e=null;if(x.timeseriesData&&x.timeseriesData[g.selectedProduct]){const t=x.getTimeseriesDataForProduct(g.selectedProduct,g.selectedYear);t&&(e=Object.entries(t).map(([e,t])=>{const a=t["production"===g.selectedMetric?"production":"import_quantity"===g.selectedMetric?"imports":"export_quantity"===g.selectedMetric?"exports":"domestic_supply_quantity"===g.selectedMetric?"domestic_supply":"feed"===g.selectedMetric?"feed":"food_supply_kcal"===g.selectedMetric?"food_supply_kcal":"production"]||0;let r=t.unit||"t";return"food_supply_kcal"===g.selectedMetric&&(r="kcal/capita/day"),{country:e,countryCode:ae(e),value:a,unit:r,year:g.selectedYear,element:g.selectedMetric}}).filter(e=>e.value>0))}else e="feed"===g.selectedMetric||"food_supply_kcal"===g.selectedMetric?[]:await x.loadProductionData(g.selectedProduct,g.selectedYear);if(e){let t=[];Array.isArray(e)?t=e.map(e=>({country:e.country||e.Area||"",countryCode:e.countryCode||e.iso3||ae(e.country||e.Area||""),value:e.value||e.Value||0,unit:e.unit||e.Unit||"t",year:e.year||e.Year||g.selectedYear,element:e.element||e.Element||g.selectedMetric})):e.data&&Array.isArray(e.data)?t=e.data.map(e=>({country:e.country||e.Area||"",countryCode:e.countryCode||e.iso3||ae(e.country||e.Area||""),value:e.value||e.Value||0,unit:e.unit||e.Unit||"t",year:e.year||e.Year||g.selectedYear,element:e.element||e.Element||g.selectedMetric})):"object"==typeof e&&(t=Object.entries(e).map(([e,t])=>({country:e,countryCode:ae(e),value:t.value||t.Value||0,unit:t.unit||t.Unit||"t",year:t.year||t.Year||g.selectedYear,element:t.element||t.Element||g.selectedMetric}))),z.value=t,ne()}}catch(e){z.value=[]}},ae=e=>({China:"CHN","China, mainland":"CHN","United States":"USA","United States of America":"USA",Brazil:"BRA",Argentina:"ARG",Ukraine:"UKR",India:"IND",Mexico:"MEX",Indonesia:"IDN",France:"FRA",Romania:"ROU",Germany:"DEU",Turkey:"TUR","Russian Federation":"RUS",Russia:"RUS",Philippines:"PHL",Nigeria:"NGA",Iran:"IRN","Iran (Islamic Republic of)":"IRN",Pakistan:"PAK",Italy:"ITA",Canada:"CAN",Thailand:"THA","South Africa":"ZAF",Egypt:"EGY",Morocco:"MAR",Kenya:"KEN",Ethiopia:"ETH",Ghana:"GHA",Tanzania:"TZA",Uganda:"UGA",Madagascar:"MDG",Mozambique:"MOZ",Cameroon:"CMR",Mali:"MLI","Burkina Faso":"BFA",Niger:"NER",Senegal:"SEN",Guinea:"GIN",Benin:"BEN",Burundi:"BDI",Rwanda:"RWA",Chad:"TCD","Central African Republic":"CAF","Democratic Republic of the Congo":"COD",Congo:"COG",Gabon:"GAB","Equatorial Guinea":"GNQ","Sao Tome and Principe":"STP","Cape Verde":"CPV",Gambia:"GMB","Guinea-Bissau":"GNB",Liberia:"LBR","Sierra Leone":"SLE","CÃ´te d'Ivoire":"CIV",Togo:"TGO",Comoros:"COM",Mauritius:"MUS",Seychelles:"SYC",Djibouti:"DJI",Eritrea:"ERI",Somalia:"SOM",Sudan:"SDN","South Sudan":"SSD",Libya:"LBY",Tunisia:"TUN",Algeria:"DZA",Spain:"ESP",Portugal:"PRT","United Kingdom":"GBR",Ireland:"IRL",Netherlands:"NLD",Belgium:"BEL",Luxembourg:"LUX",Switzerland:"CHE",Austria:"AUT",Poland:"POL","Czech Republic":"CZE",Slovakia:"SVK",Hungary:"HUN",Slovenia:"SVN",Croatia:"HRV","Bosnia and Herzegovina":"BIH",Serbia:"SRB",Montenegro:"MNE","North Macedonia":"MKD",Albania:"ALB",Greece:"GRC",Bulgaria:"BGR",Moldova:"MDA",Belarus:"BLR",Lithuania:"LTU",Latvia:"LVA",Estonia:"EST",Finland:"FIN",Sweden:"SWE",Norway:"NOR",Denmark:"DNK",Iceland:"ISL",Japan:"JPN","South Korea":"KOR","North Korea":"PRK",Mongolia:"MNG",Kazakhstan:"KAZ",Kyrgyzstan:"KGZ",Tajikistan:"TJK",Turkmenistan:"TKM",Uzbekistan:"UZB",Afghanistan:"AFG",Bangladesh:"BGD",Bhutan:"BTN",Nepal:"NPL","Sri Lanka":"LKA",Maldives:"MDV",Myanmar:"MMR",Laos:"LAO",Vietnam:"VNM",Cambodia:"KHM",Malaysia:"MYS",Singapore:"SGP",Brunei:"BRN","East Timor":"TLS","Papua New Guinea":"PNG",Australia:"AUS","New Zealand":"NZL",Fiji:"FJI","Solomon Islands":"SLB",Vanuatu:"VUT","New Caledonia":"NCL","French Polynesia":"PYF",Samoa:"WSM",Tonga:"TON",Kiribati:"KIR",Tuvalu:"TUV",Nauru:"NRU",Palau:"PLW","Marshall Islands":"MHL",Micronesia:"FSM",Czechia:"CZE","TÃ¼rkiye":"TUR",Turkey:"TUR","Viet Nam":"VNM","United Kingdom of Great Britain and Northern Ireland":"GBR","Bolivia (Plurinational State of)":"BOL","Venezuela (Bolivarian Republic of)":"VEN","Iran (Islamic Republic of)":"IRN","Korea, Republic of":"KOR","Democratic People's Republic of Korea":"PRK","Lao People's Democratic Republic":"LAO","Timor-Leste":"TLS","CÃ´te d'Ivoire":"CIV","United Republic of Tanzania":"TZA","Syrian Arab Republic":"SYR"}[e]||e.substring(0,3).toUpperCase()),re=e=>{if(!e)return"";return{"United States":"United States of America",USA:"United States of America",US:"United States of America",UK:"United Kingdom",Britain:"United Kingdom","South Korea":"Republic of Korea","North Korea":"Democratic People's Republic of Korea",Russia:"Russian Federation",Iran:"Iran (Islamic Republic of)",Syria:"Syrian Arab Republic",Venezuela:"Venezuela (Bolivarian Republic of)",Bolivia:"Bolivia (Plurinational State of)",Tanzania:"United Republic of Tanzania",Congo:"Republic of the Congo","Democratic Republic of the Congo":"Democratic Republic of the Congo",DRC:"Democratic Republic of the Congo","Czech Republic":"Czechia",Macedonia:"North Macedonia",Burma:"Myanmar","East Timor":"Timor-Leste","Cape Verde":"Cabo Verde","Ivory Coast":"CÃ´te d'Ivoire",Swaziland:"Eswatini"}[e]||e},le=e=>{const t=j();if(!t.length)return;ie(e,t);const a=n(C.value).select("svg");!a.empty()&&K.value&&ee(a)},ne=()=>{const e=C.value;if(!e)return;const t=n(e).select(".map-container");t.empty()||le(t)},ie=(e,t)=>{var a;if(!t||!Array.isArray(t))return;t.filter(e=>e.value>0).map(e=>({country:e.country,value:e.value,unit:e.unit}));const r=["World","Europe","Asia","Africa","Americas","Oceania","European Union"];t.filter(e=>r.some(t=>e.country.toLowerCase().includes(t.toLowerCase()))).length;const l=new Map,n=new Map,i=new Map;t.forEach(e=>{if(e.value>0){l.set(e.country.toLowerCase(),e.value),e.countryCode&&n.set(e.countryCode,e.value);const t=re(e.country).toLowerCase();i.set(t,e.value)}});const o=(null==(a=t.find(e=>e.unit))?void 0:a.unit)||"1000 t";O.value=o;const s=t.filter(e=>e.value>0&&!r.some(t=>e.country.toLowerCase().includes(t.toLowerCase()))).map(e=>e.value);if(s.length>0){const e=s.sort((e,t)=>e-t),t=e[0],a=e[e.length-1];u(e),p(e,.25),p(e,.75);const r=(a-t)/(Z.length-1),l=[],n=[];for(let i=0;i<Z.length-1;i++){const e=t+r*(i+1);n.push(e)}for(let i=0;i<Z.length;i++){const e=0===i?t:n[i-1],r=i===Z.length-1?a:n[i];l.push({min:e,max:r,color:Z[i]})}Y=e=>{if(e<=t)return Z[0];if(e>=a)return Z[Z.length-1];const r=(e-t)/(a-t),l=Math.floor(r*(Z.length-1)),n=Math.min(l,Z.length-1);return Z[n]},Y.thresholds=()=>n,Y.range=()=>Z,Y.domain=()=>[t,a],F.value=[t,a],Y.quantiles,K.value=Y}e.selectAll(".country").transition().duration(750).attr("fill",t=>{const a=(t.properties.name||t.properties.NAME||t.properties.admin||"").toLowerCase(),r=t.properties.iso_a3||t.properties.ISO_A3||t.properties.adm0_a3||t.properties.ADM0_A3,o=re(t.properties.name||t.properties.NAME||"").toLowerCase();let s=null;if(r&&n.has(r)?s=n.get(r):i.has(o)?s=i.get(o):l.has(a)&&(s=l.get(a)),s&&Y){const a=Y(s);return e.selectAll(".country").nodes().indexOf(t),a}return document.documentElement.classList.contains("dark")?"#374151":"#e5e7eb"}).attr("opacity",e=>{const t=(e.properties.name||e.properties.NAME||e.properties.admin||"").toLowerCase(),a=e.properties.iso_a3||e.properties.ISO_A3||e.properties.adm0_a3||e.properties.ADM0_A3,r=re(e.properties.name||e.properties.NAME||"").toLowerCase();return a&&n.has(a)||i.has(r)||l.has(t)?1:.6})},oe=(e,t)=>{e.stopPropagation(),e.preventDefault();const a=t.properties.name,r=t.properties.iso_a3;if(!a||!r)return;const l=Date.now();U&&l-U<300||(U=l,b.selectedCountry!==a&&(b.setSelectedCountry(a),v("countryClick",r)),de(t))},se=(e,t)=>{var a;const r=t.properties.name||t.properties.NAME||t.properties.admin,l=t.properties.iso_a3||t.properties.adm0_a3,i=re(r||"");n(e.currentTarget).transition().duration(100).attr("stroke","#3b82f6").attr("stroke-width",2).style("filter","brightness(1.1)");const o=j().find(e=>e.countryCode===l||e.country.toLowerCase()===(null==r?void 0:r.toLowerCase())||e.country.toLowerCase()===(null==i?void 0:i.toLowerCase()));let s=(null==o?void 0:o.unit)||"1000 t";"food_supply_kcal"===g.selectedMetric&&(s="kcal/capita/day");const c=_(s);let d=`<strong>${r}</strong><br/>`;if(o&&o.value>0){const e=c(o.value),t=(null==(a=g.selectedProduct)?void 0:a.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()))||"Produkt",r="production"===g.selectedMetric?"Produktion":"import_quantity"===g.selectedMetric?"Import":"export_quantity"===g.selectedMetric?"Export":"domestic_supply_quantity"===g.selectedMetric?"Inlandsversorgung":"feed"===g.selectedMetric?"Tierfutter":"food_supply_kcal"===g.selectedMetric?"Kalorienversorgung":"Inlandsversorgung";d+=`<span style="color: #fbbf24">${t}</span><br/>`,d+=`${r}: <strong>${e}</strong><br/>`,d+=`<span style="color: #9ca3af; font-size: 12px">Jahr: ${g.selectedYear}</span>`}else d+='<span style="color: #ef4444">Keine Daten verfÃ¼gbar</span>';G.show(e,t,()=>d),v("countryHover",l)},ce=(e,t)=>{const a=document.documentElement.classList.contains("dark")?"#4B5563":"#ffffff";n(e.currentTarget).transition().duration(100).attr("stroke",a).attr("stroke-width",.5).style("filter","none"),G.hide(),v("countryHover",null)},de=e=>{if(!H||!W)return;const t=n(C.value).select("svg");if(t.empty())return;const a=H.bounds(e),r=a[1][0]-a[0][0],l=a[1][1]-a[0][1],i=(a[0][0]+a[1][0])/2,o=(a[0][1]+a[1][1])/2,s=t.node(),c=s?s.clientWidth:g.width,d=s?s.clientHeight:g.height,u=Math.min(8,.9/Math.max(r/c,l/d)),p=[c/2-u*i,d/2-u*o];t.transition().duration(750).call(W.transform,y.translate(p[0],p[1]).scale(u))},ue=()=>{const e=n(C.value).select("svg");!e.empty()&&W&&e.transition().duration(750).call(W.transform,y)},pe=()=>{const e=n(C.value);if(e.empty())return;const t=document.documentElement.classList.contains("dark"),a=t?"#374151":"#e5e7eb",r=t?"#4B5563":"#ffffff";e.selectAll(".country").each(function(e){const t=n(this),l=t.attr("fill");"#e5e7eb"!==l&&"#374151"!==l||t.attr("fill",a),t.attr("stroke",r)})},ye=new MutationObserver(e=>{e.forEach(e=>{"attributes"===e.type&&"class"===e.attributeName&&pe()})});E([()=>g.selectedProduct,()=>g.selectedYear,()=>g.selectedMetric],async()=>{I.value&&await te()},{immediate:!0}),N(async()=>{await P(),setTimeout(async()=>{requestAnimationFrame(async()=>{try{await J(),document.documentElement&&ye.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]})}catch(e){I.value=!1}})},100)}),T(()=>{G&&G.destroy&&G.destroy(),ye.disconnect(),k.setMapInstance(null)}),m({resetZoom:ue,loadProductionData:te,zoomToCountry:de});const he={props:g,emit:v,dataStore:x,uiStore:b,vizStore:k,containerRef:w,svgContainerRef:C,isLoading:A,error:M,geoDataStatic:R,productionDataStatic:z,isInitialized:I,get lastClickTime(){return U},set lastClickTime(e){U=e},legendScale:K,legendDomain:F,legendUnit:O,get tooltipDiv(){return $},set tooltipDiv(e){$=e},tooltip:G,getProcessedProductionData:j,get projection(){return V},set projection(e){V=e},get path(){return H},set path(e){H=e},get colorScale(){return Y},set colorScale(e){Y=e},get zoom(){return W},set zoom(e){W=e},greenColorScheme:Z,mapConfig:q,initializeMap:J,createMapDirect:X,drawCountriesDirect:Q,createLegend:ee,setupMap:(e,t)=>{(null==t?void 0:t.features)&&Array.isArray(t.features)},drawCountries:(e,t)=>{t&&Array.isArray(t)&&t.length},loadProductionData:te,getCountryCode:ae,normalizeCountryName:re,updateMapWithProductionDataDirect:le,updateMapWithProductionDataStatic:ne,applyProductionDataDirect:ie,updateMapWithProductionData:()=>{if(!j().length)return;const e=n(C.value).select(".map-container");e.empty()||le(e)},handleCountryClick:oe,handleCountryMouseover:se,handleCountryMouseout:ce,zoomToCountry:de,resetZoom:ue,updateThemeStyles:pe,themeObserver:ye,handleResize:()=>{},BaseButton:l,LoadingSpinner:r};return Object.defineProperty(he,"__isScriptSetup",{enumerable:!1,value:!0}),he}}),[["render",function(e,t,a,r,l,n){return U(),I("div",Z,[r.isLoading?(U(),K(r.LoadingSpinner,{key:0,overlay:!0,centered:!0,text:"LÃ¤dt Karte...",size:"md"})):F("",!0),r.error?(U(),I("div",q,[O("div",J,[O("p",X,G(r.error),1),$(r.BaseButton,{variant:"danger",size:"sm",onClick:r.initializeMap},{default:j(()=>t[0]||(t[0]=[V(" Erneut versuchen ")])),_:1,__:[0]})])])):F("",!0),O("div",Q,[$(r.BaseButton,{variant:"secondary",size:"sm",icon:!0,class:"!p-2",title:"Zoom zurÃ¼cksetzen",onClick:r.resetZoom},{default:j(()=>t[1]||(t[1]=[O("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[O("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)])),_:1,__:[1]})]),O("div",ee,[r.isInitialized||r.isLoading||r.error?F("",!0):(U(),I("div",te,t[2]||(t[2]=[O("p",null,"Karte wird initialisiert...",-1)])))],512)],512)}],["__scopeId","data-v-4dcd1017"],["__file","WorldMap.vue"]]),re=["#059669","#dc2626","#2563eb","#f59e0b","#8b5cf6","#ec4899","#14b8a6","#f97316","#6366f1","#84cc16","#06b6d4","#a855f7","#047857","#b91c1c","#1e40af","#d97706","#7c3aed","#db2777","#0d9488","#ea580c","#4f46e5","#65a30d","#0891b2","#9333ea"];function le(){const e=new Map;let t=0;return function(a){return e.has(a)||(e.set(a,re[t%re.length]),t++),e.get(a)}}const ne=z({__name:"TimeseriesChart",props:{width:{default:600},height:{default:400},selectedCountries:{default:()=>[]},selectedProducts:{default:()=>[]},selectedMetric:{default:"production"},chartData:{default:()=>[]},showGrid:{type:Boolean,default:!0},showPoints:{type:Boolean,default:!0}},emits:["pointHover","pointClick"],setup(t,{expose:a,emit:i}){const o=t,s=i,u=e(),p=D(),y=D(!1),w=D(null),C=D([]),A=D(le()),M={top:20,right:120,bottom:40,left:60};let R,z,L,B,P,I,U;const K=()=>{if(!p.value)return;n(p.value).selectAll("*").remove();const e=p.value.getBoundingClientRect(),t=e.width||600,a=e.height||400,r=t-M.left-M.right,l=a-M.top-M.bottom;R=n(p.value).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${t} ${a}`).attr("preserveAspectRatio","xMidYMid meet").attr("class","timeseries-chart"),z=R.append("g").attr("transform",`translate(${M.left},${M.top})`),L=h().range([0,r]),B=c().range([l,0]),P=m().x(e=>L(new Date(e.year,0,1))).y(e=>B(e.value)).curve(f),z.append("g").attr("class","x-axis").attr("transform",`translate(0,${l})`),z.append("g").attr("class","y-axis"),o.showGrid&&(z.append("g").attr("class","grid x-grid").attr("transform",`translate(0,${l})`),z.append("g").attr("class","grid y-grid"));const i=document.documentElement.classList.contains("dark")?"#9CA3AF":"#374151";z.append("text").attr("class","x-label").attr("text-anchor","middle").attr("x",r/2).attr("y",l+35).text("Jahr").style("font-size","12px").style("fill",i),z.append("text").attr("class","y-label").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("x",-l/2).attr("y",-40).text(O()).style("font-size","12px").style("fill",i),I=n("body").append("div").attr("class","timeseries-tooltip").style("position","absolute").style("padding","8px 12px").style("background","rgba(6, 78, 59, 0.95)").style("color","white").style("border","1px solid #10b981").style("border-radius","6px").style("font-size","12px").style("font-weight","500").style("pointer-events","none").style("opacity",0).style("z-index",1e3).style("box-shadow","0 4px 6px -1px rgba(0, 0, 0, 0.1)"),F()},F=()=>{p.value&&window.ResizeObserver&&(U=new ResizeObserver(()=>{chartData.value.length>0&&G()}),U.observe(p.value))},O=()=>{switch(o.selectedMetric){case"production":return"Produktion (Mio. t)";case"import_quantity":return"Import (Mio. t)";case"export_quantity":return"Export (Mio. t)";case"domestic_supply_quantity":return"Inlandsversorgung (Mio. t)";default:return"Wert (Mio. t)"}},$=()=>{C.value=o.chartData||[],A.value=le(),C.value.length>0&&G()},G=()=>{var e;if(!z||!C.value.length)return;const t=C.value.filter(e=>e.value>0).sort((e,t)=>e.year-t.year);if(!t.length)return;const a=null==(e=p.value)?void 0:e.getBoundingClientRect(),r=(null==a?void 0:a.width)||600,l=(null==a?void 0:a.height)||400,i=r-M.left-M.right,s=l-M.top-M.bottom;R.attr("viewBox",`0 0 ${r} ${l}`);const c=g(t,e=>e.series),u=t.map(e=>new Date(e.year,0,1)),y=t.map(e=>e.value);L.domain(v(u)),B.domain([0,x(y)]);const h=document.documentElement.classList.contains("dark"),m=h?"#9CA3AF":"#374151",f=h?"#4B5563":"#E5E7EB",w=d(L).tickFormat(b("%Y")).tickSizeOuter(0),_=k(B).tickFormat(S("1000 t")).tickSizeOuter(0),D=z.select(".x-axis").transition().duration(750).call(w),E=z.select(".y-axis").transition().duration(750).call(_);if(D.selectAll("path").style("stroke",m).style("stroke-width","1px"),D.selectAll("line").style("stroke",m).style("stroke-width","1px"),D.selectAll("text").style("fill",m).style("font-size","12px"),E.selectAll("path").style("stroke",m).style("stroke-width","1px"),E.selectAll("line").style("stroke",m).style("stroke-width","1px"),E.selectAll("text").style("fill",m).style("font-size","12px"),o.showGrid){const e=z.select(".x-grid").transition().duration(750).call(d(L).tickSize(-s).tickFormat(()=>"").tickSizeOuter(0)),t=z.select(".y-grid").transition().duration(750).call(k(B).tickSize(-i).tickFormat(()=>"").tickSizeOuter(0));e.selectAll("path").style("stroke","none"),e.selectAll("line").style("stroke",f).style("stroke-width","1px").style("opacity",.5),t.selectAll("path").style("stroke","none"),t.selectAll("line").style("stroke",f).style("stroke-width","1px").style("opacity",.5)}z.selectAll(".line-path").remove(),z.selectAll(".series-group").remove();z.selectAll(".series-group").data(Array.from(c.entries()),e=>e[0]).enter().append("g").attr("class","series-group").each(function([e,t]){const a=t.sort((e,t)=>e.year-t.year),r=A.value(e);n(this).append("path").attr("class","line-path").attr("fill","none").attr("stroke",r).attr("stroke-width",2.5).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("opacity",0).attr("d",P(a)).transition().duration(750).attr("opacity",1)}),o.showPoints&&(z.selectAll(".data-point").remove(),t.forEach(e=>{const t=A.value(e.series);z.append("circle").attr("class","data-point").attr("r",0).attr("fill",t).attr("stroke","white").attr("stroke-width",2).style("cursor","pointer").attr("cx",L(new Date(e.year,0,1))).attr("cy",B(e.value)).datum(e).on("mouseover",j).on("mouseout",V).on("click",H).transition().duration(750).attr("r",4)})),z.select(".y-label").text(O()).style("fill",m),z.select(".x-label").style("fill",m),z.selectAll(".legend").remove();const N=z.append("g").attr("class","legend").attr("transform",`translate(${i+10}, 20)`),T=Array.from(c.keys()).sort();T.forEach((e,t)=>{const a=N.append("g").attr("transform",`translate(0, ${20*t})`);a.append("rect").attr("width",12).attr("height",12).attr("fill",A.value(e)).attr("rx",2),a.append("text").attr("x",18).attr("y",9).text(e).style("font-size","11px").style("fill",m).style("alignment-baseline","middle")})},j=(e,t)=>{const a=A.value(t.series);n(e.target).transition().duration(150).attr("r",6).attr("stroke-width",3),I.style("opacity",1).style("background",a).style("border-color",a).html(`\n      <strong>${t.series}</strong><br/>\n      Jahr: ${t.year}<br/>\n      ${O().replace("(Mio. t)","")}: ${_("1000 t")(t.value)}\n    `).style("left",e.pageX+10+"px").style("top",e.pageY-10+"px"),s("pointHover",t)},V=e=>{n(e.target).transition().duration(150).attr("r",4).attr("stroke-width",2),I.style("opacity",0),s("pointHover",null)},H=(e,t)=>{s("pointClick",t)},Y=()=>{U&&U.disconnect(),I&&I.remove(),p.value&&n(p.value).selectAll("*").remove()},W=()=>{if(!z)return;const e=document.documentElement.classList.contains("dark"),t=e?"#9CA3AF":"#374151",a=e?"#4B5563":"#E5E7EB";z.select(".x-axis").selectAll("path").style("stroke",t),z.select(".x-axis").selectAll("line").style("stroke",t),z.select(".x-axis").selectAll("text").style("fill",t),z.select(".y-axis").selectAll("path").style("stroke",t),z.select(".y-axis").selectAll("line").style("stroke",t),z.select(".y-axis").selectAll("text").style("fill",t),z.select(".x-grid").selectAll("line").style("stroke",a),z.select(".y-grid").selectAll("line").style("stroke",a),z.select(".x-label").style("fill",t),z.select(".y-label").style("fill",t)},Z=new MutationObserver(e=>{e.forEach(e=>{"attributes"===e.type&&"class"===e.attributeName&&W()})});E(()=>o.chartData,()=>{$()},{deep:!0}),N(()=>{K(),$(),document.documentElement&&Z.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]})}),T(()=>{Y(),Z.disconnect()}),a({loadData:$,updateChart:G});const q={props:o,emit:s,dataStore:u,svgContainerRef:p,isLoading:y,error:w,localChartData:C,colorScale:A,margin:M,get svg(){return R},set svg(e){R=e},get g(){return z},set g(e){z=e},get xScale(){return L},set xScale(e){L=e},get yScale(){return B},set yScale(e){B=e},get line(){return P},set line(e){P=e},get tooltip(){return I},set tooltip(e){I=e},get resizeObserver(){return U},set resizeObserver(e){U=e},initializeChart:K,setupResizeObserver:F,getMetricLabel:O,loadData:$,updateChart:G,handlePointMouseover:j,handlePointMouseout:V,handlePointClick:H,cleanup:Y,updateThemeStyles:W,observer:Z,BaseButton:l,LoadingSpinner:r};return Object.defineProperty(q,"__isScriptSetup",{enumerable:!1,value:!0}),q}}),ie={class:"timeseries-chart-wrapper relative w-full h-full flex flex-col"},oe={key:1,class:"absolute inset-0 bg-error-50 dark:bg-error-900/20 flex items-center justify-center z-10"},se={class:"text-center"},ce={class:"text-error-600 dark:text-error-400 mb-3"},de={key:2,class:"px-4 py-2 border-b border-gray-200 dark:border-gray-700 flex-shrink-0"},ue={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},pe={ref:"svgContainerRef",class:"timeseries-svg-container flex-1 w-full min-h-0"},ye={key:3,class:"absolute inset-0 flex items-center justify-center text-gray-500 dark:text-gray-400"};const he=R(ne,[["render",function(e,t,a,r,l,n){return U(),I("div",ie,[r.isLoading?(U(),K(r.LoadingSpinner,{key:0,overlay:!0,centered:!0,text:"LÃ¤dt Zeitreihen...",size:"md"})):F("",!0),r.error?(U(),I("div",oe,[O("div",se,[O("p",ce,G(r.error),1),$(r.BaseButton,{variant:"danger",size:"sm",onClick:r.loadData},{default:j(()=>t[0]||(t[0]=[V(" Erneut versuchen ")])),_:1,__:[0]})])])):F("",!0),r.localChartData.length>0?(U(),I("div",de,[O("h4",ue,G(r.getMetricLabel()),1)])):F("",!0),O("div",pe,null,512),r.isLoading||r.error||0!==r.localChartData.length?F("",!0):(U(),I("div",ye,t[1]||(t[1]=[O("div",{class:"text-center"},[O("svg",{class:"w-12 h-12 mx-auto mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[O("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})]),O("p",null,"Keine Zeitreihen-Daten verfÃ¼gbar"),O("p",{class:"text-xs mt-1"},"WÃ¤hlen Sie Produkte und LÃ¤nder aus")],-1)])))])}],["__file","TimeseriesChart.vue"]]),me={ref:"containerRef",class:"chart-container relative w-full bg-white dark:bg-gray-800 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700"},fe={key:1,class:"absolute inset-0 bg-error-50 dark:bg-error-900/20 flex items-center justify-center z-10"},ge={class:"text-center"},ve={class:"text-error-600 dark:text-error-400 mb-3"},xe={key:2,class:"p-4 border-b border-gray-200 dark:border-gray-700"},be={key:3,class:"p-4 min-h-[400px]"},ke={key:4,class:"absolute inset-0 flex items-center justify-center text-gray-500 dark:text-gray-400 pointer-events-none"};const we=R(z({__name:"SimulationChart",props:{data:{default:()=>[]},config:{default:()=>({})},width:{default:800},height:{default:500},selectedScenario:{default:"climate_change"},simulationRuns:{default:100}},emits:["scenario-select","runSimulation"],setup(e,{expose:t,emit:l}){t();const i=e,o=l,s=a(),u=D(),p=D(null),y=D(!1),h=D(null),g=B(()=>({top:20,right:30,bottom:40,left:60})),x=B(()=>{const e=u.value;if(!e)return{width:800,height:400};const t=e.getBoundingClientRect();return{width:Math.max(400,t.width||800),height:400}}),b=B(()=>({baselineColor:"#6b7280",scenarioColor:"#ef4444"})),A=async()=>{await P();try{y.value=!0,h.value=null,await M()}catch(e){h.value="Fehler beim Initialisieren der Simulation"}finally{y.value=!1}},M=async()=>{if(!u.value)return;const e=i.data||[],{width:t,height:a}=x.value,r=g.value;n(u.value).selectAll("*").remove();const l=n(u.value).append("svg").attr("width",t).attr("height",a).attr("class","simulation-svg");p.value=l.node();const o=l.append("g").attr("transform",`translate(${r.left},${r.top})`),s=t-r.left-r.right,y=a-r.top-r.bottom;if(0===e.length)return void o.append("text").attr("class","empty-text").attr("x",s/2).attr("y",y/2).attr("text-anchor","middle").style("font-size","14px").style("fill","currentColor").style("opacity",.6).text("Keine Simulationsdaten verfÃ¼gbar");const h=c().domain(v(e,e=>e.year)).range([0,s]),A=e.reduce((e,t)=>{if(t&&"object"==typeof t){const a=[t.baseline,t.scenario,t.lower,t.upper].filter(e=>null!=e&&!isNaN(e));e.push(...a)}return e},[]),M=c().domain(v(A)).nice().range([y,0]),_=m().x(e=>h(e.year)).y(e=>M(e.baseline)).defined(e=>null!==e.baseline&&void 0!==e.baseline&&!isNaN(e.baseline)).curve(f),R=m().x(e=>h(e.year)).y(e=>M(e.scenario)).defined(e=>null!==e.scenario&&void 0!==e.scenario&&!isNaN(e.scenario)).curve(f),z=w().x(e=>h(e.year)).y0(e=>M(e.lower)).y1(e=>M(e.upper)).defined(e=>null!==e.lower&&void 0!==e.lower&&null!==e.upper&&void 0!==e.upper&&!isNaN(e.lower)&&!isNaN(e.upper)).curve(f);o.append("g").attr("class","x-axis").attr("transform",`translate(0, ${y})`).call(d(h).tickFormat(C("d"))).selectAll("text").style("fill","currentColor"),o.append("g").attr("class","y-axis").call(k(M).tickFormat(S("1000 t"))).selectAll("text").style("fill","currentColor"),o.selectAll(".domain, .tick line").style("stroke","currentColor").style("opacity",.3),o.append("path").datum(e).attr("class","confidence-area").attr("d",z).style("fill",b.value.scenarioColor).style("fill-opacity",.2),o.append("path").datum(e).attr("class","baseline-line").attr("d",_).style("stroke",b.value.baselineColor).style("stroke-width",2).style("fill","none"),o.append("path").datum(e).attr("class","scenario-line").attr("d",R).style("stroke",b.value.scenarioColor).style("stroke-width",2).style("fill","none").style("stroke-dasharray","5,5");const D=o.append("g").attr("class","legend").attr("transform",`translate(${s-120}, 20)`);D.append("line").attr("x1",0).attr("x2",20).attr("y1",0).attr("y2",0).style("stroke",b.value.baselineColor).style("stroke-width",2),D.append("text").attr("x",25).attr("y",4).style("font-size","12px").style("fill","currentColor").text("Baseline"),D.append("line").attr("x1",0).attr("x2",20).attr("y1",20).attr("y2",20).style("stroke",b.value.scenarioColor).style("stroke-width",2).style("stroke-dasharray","5,5"),D.append("text").attr("x",25).attr("y",24).style("font-size","12px").style("fill","currentColor").text("Szenario")};N(()=>{A()}),E(()=>i.data,()=>{A()},{deep:!0}),T(()=>{u.value&&n(u.value).selectAll("*").remove()});const _={props:i,emit:o,vizStore:s,containerRef:u,svgRef:p,isLoading:y,error:h,margin:g,dimensions:x,chartConfig:b,initializeChart:A,setupChart:M,LoadingSpinner:r};return Object.defineProperty(_,"__isScriptSetup",{enumerable:!1,value:!0}),_}}),[["render",function(e,t,a,r,l,n){const i=H("BaseButton");return U(),I("div",me,[r.isLoading?(U(),K(r.LoadingSpinner,{key:0,overlay:!0,centered:!0,text:"LÃ¤dt Simulation...",size:"md"})):F("",!0),r.error?(U(),I("div",fe,[O("div",ge,[O("p",ve,G(r.error),1),$(i,{variant:"danger",size:"sm",onClick:r.initializeChart},{default:j(()=>t[0]||(t[0]=[V(" Erneut versuchen ")])),_:1,__:[0]})])])):F("",!0),a.data&&a.data.length>0?(U(),I("div",xe,t[1]||(t[1]=[O("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"}," Simulationsergebnisse ",-1),O("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," Zeitreihen-Analyse mit Konfidenzintervallen ",-1)]))):F("",!0),a.data&&a.data.length>0?(U(),I("div",be)):F("",!0),a.data&&0!==a.data.length?F("",!0):(U(),I("div",ke,t[2]||(t[2]=[O("div",{class:"text-center"},[O("svg",{class:"w-12 h-12 mx-auto mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[O("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})]),O("p",null,"Bereit fÃ¼r Simulation"),O("p",{class:"text-xs mt-1"},"Starten Sie eine Simulation, um die Ergebnisse zu sehen")],-1)])))],512)}],["__file","SimulationChart.vue"]]);const Ce=R({__name:"MLChart",props:{data:{type:Array,default:()=>[]},config:{type:Object,default:()=>({})}},emits:["prediction-select","confidence-toggle"],setup(e,{expose:a,emit:r}){a();const l=e,i=r,o=t(),s=D(null),u=D(null),p=D(null);let y=null;const{dimensions:h,isReady:g,createSVG:b,updateDimensions:R}=W(s,{}),z=D(!0),L=B(()=>o.isDarkMode),P=e=>{const t=e.predicted_value;let a=e.confidence_lower,r=e.confidence_upper;const l=a,n=r,i=3*t,o=Math.max(0,.1*t);if(r-a>i){const e=i/2;a=Math.max(o,t-e),r=t+e}0===a&&t>1e5&&(a=Math.max(o,.2*t));const s=2.5*t;return r>s&&(r=s),Math.abs(l-a)>.1*t||Math.abs(n-r),{...e,confidence_lower:a,confidence_upper:r}},I=B(()=>{var e,t,a,r;let n=800;"100%"===(null==(e=l.config)?void 0:e.width)?n=(null==(t=s.value)?void 0:t.clientWidth)||800:(null==(a=l.config)?void 0:a.width)&&(n=l.config.width);const i=(null==(r=l.config)?void 0:r.height)||400,o={top:40,right:150,bottom:60,left:80};return{width:n,height:i,innerWidth:n-o.left-o.right,innerHeight:i-o.top-o.bottom,margin:o}}),U=B(()=>{if(!l.data||0===l.data.length)return{predictions:[],historical:[]};return{predictions:l.data.filter(e=>e.type?"prediction"===e.type&&(e.predicted_value>0||e.value>0):e.year>=2023&&(e.predicted_value>0||e.value>0)),historical:l.data.filter(e=>e.type?"historical"===e.type&&(e.value>0||e.predicted_value>0):e.year<2023&&(e.value>0||e.predicted_value>0))}}),K=()=>{if(!g.value||!s.value)return;const{width:e,height:t,margin:a}=I.value;n(s.value).selectAll("svg").remove();const r=b({width:e,height:t,className:"ml-chart-svg",margin:a});r&&(u.value=r.svg,p.value=r.g,F())},F=()=>{if(!p.value||!l.data||0===l.data.length)return;const{innerWidth:e,innerHeight:t}=I.value,{predictions:a,historical:r}=U.value;p.value.selectAll("*").remove();const o=[...r,...a].map(e=>e.year),s=a.filter(e=>null!=e.confidence_lower&&null!=e.confidence_upper&&null!=e.predicted_value&&e.predicted_value>0).map(P),u=[...r.map(e=>e.predicted_value||e.value).filter(e=>null!=e&&e>0),...a.map(e=>e.predicted_value).filter(e=>null!=e&&e>0),...s.map(e=>e.confidence_lower).filter(e=>null!=e&&e>0),...s.map(e=>e.confidence_upper).filter(e=>null!=e&&e>0)];if(0===o.length||0===u.length)return;const y=c().domain(v(o)).range([0,e]),h=c().domain([0,1.1*x(u)]).range([t,0]),g=m().x(e=>y(e.year)).y(e=>h(e.predicted_value||e.value||0)).curve(f),b=w().x(e=>y(e.year)).y0(e=>h(e.confidence_lower||e.predicted_value||e.value||0)).y1(e=>h(e.confidence_upper||e.predicted_value||e.value||0)).curve(f),A=p.value.append("g").attr("transform",`translate(0,${t})`).call(d(y).tickFormat(C("d"))),R=p.value.append("g").call(k(h).tickFormat(S("1000 t")));if(A.append("text").attr("x",e/2).attr("y",40).style("text-anchor","middle").style("fill","currentColor").attr("class","axis-label").text("Jahr"),R.append("text").attr("transform","rotate(-90)").attr("y",-60).attr("x",-t/2).style("text-anchor","middle").style("fill","currentColor").attr("class","axis-label").text("Produktion (Mio. t)"),p.value.append("g").attr("class","grid").attr("transform",`translate(0,${t})`).call(d(y).tickSize(-t).tickFormat("")).style("stroke-dasharray","3,3").style("opacity",.3),p.value.append("g").attr("class","grid").call(k(h).tickSize(-e).tickFormat("")).style("stroke-dasharray","3,3").style("opacity",.3),z.value&&a.length>0){const e=a.filter(e=>null!=e.confidence_lower&&null!=e.confidence_upper&&e.confidence_upper>e.confidence_lower&&null!=e.predicted_value&&e.predicted_value>0).map(P);e.length>0&&p.value.append("path").datum(e).attr("fill","#60a5fa").attr("fill-opacity",.2).attr("d",b)}if(r.length>0&&(p.value.append("path").datum(r).attr("fill","none").attr("stroke","#10b981").attr("stroke-width",2).attr("d",g),p.value.selectAll(".hist-dot").data(r).enter().append("circle").attr("class","hist-dot").attr("cx",e=>y(e.year)).attr("cy",e=>h(e.predicted_value||e.value)).attr("r",4).attr("fill","#10b981")),a.length>0){const e=r[r.length-1],t=e?[{...e,predicted_value:e.value},...a]:a;p.value.append("path").datum(t).attr("fill","none").attr("stroke","#3b82f6").attr("stroke-width",2).attr("stroke-dasharray","5,5").attr("d",g),p.value.selectAll(".pred-dot").data(a).enter().append("circle").attr("class","pred-dot").attr("cx",e=>y(e.year)).attr("cy",e=>h(e.predicted_value||e.value)).attr("r",4).attr("fill","#3b82f6").style("cursor","pointer").on("click",(e,t)=>{i("prediction-select",t)}).on("mouseenter",function(e,t){var a;n(this).attr("r",6);const r=L.value,l=n("body").append("div").attr("class","ml-chart-tooltip").style("position","absolute").style("background",r?"rgba(31, 41, 55, 0.95)":"rgba(255, 255, 255, 0.95)").style("color",r?"#f9fafb":"#111827").style("padding","10px 12px").style("border-radius","8px").style("font-size","12px").style("font-weight","500").style("line-height","1.5").style("box-shadow",r?"0 10px 25px rgba(0, 0, 0, 0.5)":"0 10px 25px rgba(0, 0, 0, 0.15)").style("border",r?"1px solid rgba(75, 85, 99, 0.3)":"1px solid rgba(209, 213, 219, 0.3)").style("backdrop-filter","blur(10px)").style("pointer-events","none").style("z-index","1000").style("opacity",0),i=P(t),o=_("1000 t");l.html(`\n          <strong>Jahr ${t.year}</strong><br/>\n          Prognose: ${o(i.predicted_value)}<br/>\n          Konfidenz: ${o(i.confidence_lower)} - ${o(i.confidence_upper)}<br/>\n          Unsicherheit: ${(null==(a=t.uncertainty_percent)?void 0:a.toFixed(1))||"N/A"}%\n        `).style("left",e.pageX+10+"px").style("top",e.pageY-10+"px").transition().duration(200).style("opacity",1)}).on("mouseleave",function(){n(this).attr("r",4),M(".ml-chart-tooltip").remove()})}const D=p.value.append("g").attr("transform",`translate(${e-120}, 20)`);D.append("rect").attr("x",-10).attr("y",-10).attr("width",140).attr("height",70).attr("rx",4).attr("class","legend-background");[{label:"Historisch",color:"#10b981",dash:!1},{label:"Prognose",color:"#3b82f6",dash:!0},{label:"Konfidenzintervall",color:"#60a5fa",dash:!1,area:!0}].forEach((e,t)=>{const a=D.append("g").attr("transform",`translate(0, ${20*t})`);e.area?a.append("rect").attr("width",15).attr("height",10).attr("class","legend-area-indicator").attr("fill",e.color).attr("fill-opacity",.2):a.append("line").attr("x1",0).attr("x2",15).attr("y1",5).attr("y2",5).attr("class","legend-line "+(e.dash?"legend-line-dashed":"legend-line-solid")).attr("stroke",e.color).attr("stroke-width",2).attr("stroke-dasharray",e.dash?"5,5":null),a.append("text").attr("x",20).attr("y",5).attr("dy","0.35em").attr("class","legend-text").text(e.label)});const B=p.value.append("g").attr("transform","translate(20, 20)").style("cursor","pointer").on("click",()=>{z.value=!z.value,i("confidence-toggle",z.value),F()});B.append("rect").attr("width",140).attr("height",25).attr("rx",4).attr("class","confidence-toggle "+(z.value?"confidence-toggle-active":"confidence-toggle-inactive")),B.append("text").attr("x",70).attr("y",12.5).attr("text-anchor","middle").attr("dy","0.35em").attr("class","confidence-toggle-text "+(z.value?"confidence-toggle-text-active":"confidence-toggle-text-inactive")).text("Konfidenzintervall")};E(g,e=>{e&&K()}),E(()=>l.data,()=>{g.value&&F()},{deep:!0}),E(()=>l.config,()=>{g.value&&K()},{deep:!0}),E(()=>o.isDarkMode,()=>{g.value&&F()}),N(()=>{g.value&&K(),s.value&&ResizeObserver&&(y=new ResizeObserver(e=>{setTimeout(()=>{g.value&&K()},100)}),y.observe(s.value))}),T(()=>{y&&(y.disconnect(),y=null)});const O={props:l,emit:i,uiStore:o,containerRef:s,svgRef:u,gRef:p,get resizeObserver(){return y},set resizeObserver(e){y=e},dimensions:h,isReady:g,createSVG:b,updateDimensions:R,showConfidenceInterval:z,isDarkMode:L,correctConfidenceInterval:P,chartDimensions:I,processedData:U,initChart:K,drawChart:F,ref:D,computed:B,watch:E,onMounted:N,onUnmounted:T,get d3(){return A},get useD3(){return W},get useUIStore(){return t},get createD3AxisFormatter(){return S},get createD3TooltipFormatter(){return _}};return Object.defineProperty(O,"__isScriptSetup",{enumerable:!1,value:!0}),O}},[["render",function(e,t,a,r,l,n){return U(),I("div",{ref:"containerRef",class:"ml-chart w-full",style:Y({height:r.chartDimensions.height+"px"})},null,4)}],["__scopeId","data-v-f219aad1"],["__file","MLChart.vue"]]);export{Ce as M,we as S,he as T,ae as W};
//# sourceMappingURL=visualizations-D5gvM8XN.js.map
